<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
<title>SIBEM Vídeos</title>
<meta name="theme-color" content="#fff" />
<style>
/* ===== SIBEM Video Player - Tema Claro Completo ===== */
:root{
  --svp-bg:#ffffff; --svp-card:#ffffff; --svp-elev:#f8f9fa; --svp-text:#0f0f0f; --svp-sub:#606060;
  --svp-accent:#ff2d55; --svp-accent-2:#3ea6ff; --svp-ok:#22c55e; --svp-warn:#f59e0b; --svp-danger:#ef4444;
  --svp-chip:#e5e5e5; --svp-border:#e5e5e5; --svp-hover:#f5f5f5;
}
*{box-sizing:border-box}
html,body{
  margin:0;padding:0;background:var(--svp-bg);color:var(--svp-text);
  font-family:Inter,system-ui,Roboto,Helvetica,Arial,sans-serif;
  overflow-x:hidden;width:100vw;height:100vh;position:fixed;
}
button,input,select{font:inherit}
a{color:inherit;text-decoration:none}

.svp-app{
  display:flex;flex-direction:column;height:100vh;width:100vw;position:fixed;top:0;left:0;overflow:hidden;
}

.svp-topbar{
  position:sticky;top:0;z-index:50;background:rgba(255,255,255,.95);backdrop-filter:blur(10px);
  border-bottom:1px solid var(--svp-border);flex-shrink:0;
}

.svp-header-main{display:flex;align-items:center;gap:.5rem;padding:.75rem}

.svp-logo{display:flex;align-items:center;gap:.5rem;font-weight:700;font-size:.9rem}
.svp-logo svg{width:20px;height:20px;fill:var(--svp-accent)}

.svp-search{
  display:flex;align-items:center;gap:.5rem;background:var(--svp-elev);border:1px solid var(--svp-border);
  border-radius:20px;padding:.4rem .6rem;flex:1;margin:0 .5rem;width:58px;
}
.svp-search input{flex:1;background:transparent;border:0;outline:none;color:var(--svp-text);font-size:16px; width:48px}
.svp-search button{background:transparent;border:0;color:var(--svp-sub);display:flex;padding:.25rem}
.svp-search svg{width:18px;height:18px}

.svp-nav-btns{display:flex;gap:.25rem}
.svp-nav-btn{
  background:transparent;border:0;color:var(--svp-sub);padding:.5rem .75rem;border-radius:20px;
  font-size:.85rem;font-weight:600;transition:all .2s;
}
.svp-nav-btn.is-active{background:var(--svp-text);color:#fff}
.svp-nav-btn:not(.is-active):hover{background:var(--svp-hover)}

.svp-cats{
  display:flex;gap:.5rem;padding:.5rem .75rem;border-bottom:1px solid var(--svp-border);overflow:auto;
  scrollbar-width:none;-ms-overflow-style:none;
}
.svp-cats::-webkit-scrollbar{display:none}
.svp-chip{
  background:var(--svp-chip);color:var(--svp-sub);border:0;border-radius:999px;
  padding:.35rem .8rem;white-space:nowrap;font-size:.85rem;
}
.svp-chip.is-active{background:var(--svp-text);color:#fff;font-weight:600}

.svp-content{flex:1;overflow-y:auto;overflow-x:hidden;position:relative}
.svp-page{display:none;height:100%}
.svp-page.is-active{display:block}

.svp-grid{
  padding:.75rem;display:grid;grid-template-columns:1fr;gap:.8rem;
}
@media(min-width:480px){.svp-grid{grid-template-columns:1fr 1fr}}
@media(min-width:768px){.svp-grid{grid-template-columns:1fr 1fr 1fr}}

.svp-card{
  background:var(--svp-card);border-radius:12px;overflow:hidden;cursor:pointer;
  box-shadow:0 1px 3px rgba(0,0,0,.1);
}
.svp-thumb-wrap{position:relative;border-radius:12px;overflow:hidden;background:#000}
.svp-thumb{width:100%;aspect-ratio:16/9;object-fit:cover;background:#000}
.svp-dur{
  position:absolute;right:.5rem;bottom:.5rem;background:rgba(0,0,0,.7);color:#fff;
  padding:.15rem .35rem;border-radius:6px;font-size:.75rem;
}
.svp-meta{display:flex;gap:.6rem;margin-top:.5rem;padding:0 .5rem .5rem}
.svp-avatar{
  width:36px;height:36px;border-radius:50%;background:#ddd;flex:0 0 36px;
  background-size:cover;background-position:center;border:2px solid var(--svp-border);
}
.svp-title{
  font-weight:600;line-height:1.25;margin:0 0 .15rem;font-size:.95rem;color:var(--svp-text);
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
}
.svp-sub{color:var(--svp-sub);font-size:.85rem;display:flex;align-items:center;gap:.25rem}

.svp-actions{display:flex;align-items:center;gap:.75rem;margin-top:.4rem}
.svp-action{
  display:inline-flex;align-items:center;gap:.35rem;background:transparent;border:0;
  color:var(--svp-sub);padding:.25rem .5rem;border-radius:20px;transition:background .2s;font-size:.85rem;
}
.svp-action:hover{background:var(--svp-hover)}
.svp-action svg{width:16px;height:16px;fill:currentColor}
.svp-action.is-like{color:var(--svp-accent-2)}
.svp-action.is-danger{color:var(--svp-danger)}

.svp-studio{padding:1rem;height:100%;overflow-y:auto}
.svp-form{
  background:var(--svp-card);border:1px solid var(--svp-border);border-radius:12px;
  padding:1rem;display:grid;gap:.6rem;box-shadow:0 1px 3px rgba(0,0,0,.1);
}
.svp-row{display:grid;gap:.35rem}
.svp-input,.svp-select,.svp-file,.svp-btn{
  width:100%;border-radius:10px;border:1px solid var(--svp-border);background:var(--svp-bg);
  color:var(--svp-text);padding:.75rem;font-size:16px;
}
.svp-file{padding:.55rem}
.svp-btn{background:var(--svp-accent);border:0;font-weight:700;color:#fff}
.svp-btn.alt{background:var(--svp-chip);color:var(--svp-text)}
.svp-hint{color:var(--svp-sub);font-size:.85rem}
.svp-cover-preview{
  width:100%;aspect-ratio:16/9;border-radius:10px;background:var(--svp-elev);
  object-fit:cover;border:1px dashed var(--svp-border);
}

.svp-mylist{margin-top:1rem}
.svp-empty{color:var(--svp-sub);text-align:center;padding:1rem}

/* Player Overlay - Tela Cheia Consistente */
.svp-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background: var(--svp-bg);
  z-index: 1000;
  display: none;
  flex-direction: column;
}
.svp-overlay.is-open {
  display: flex;
}

.svp-player-header{
  background:var(--svp-bg);border-bottom:1px solid var(--svp-border);
  display:flex;justify-content:space-between;align-items:center;padding:1rem;
  flex-shrink:0;
}

.svp-player-title-wrap{flex:1;padding-right:1rem}
.svp-player-title-main{font-size:1.1rem;font-weight:600;margin-bottom:.25rem;color:var(--svp-text)}
.svp-player-meta{font-size:.85rem;color:var(--svp-sub)}

.svp-player-controls{display:flex;gap:.5rem}
.svp-player-btn{
  background:var(--svp-hover);border:1px solid var(--svp-border);color:var(--svp-text);
  width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;
  transition:background .2s;cursor:pointer;
}
.svp-player-btn:hover{background:var(--svp-chip)}
.svp-player-btn svg{width:20px;height:20px;fill:currentColor}

/* Vídeo com tamanho consistente */
.svp-player-video {
  background:#000;
  position:relative;
  width:100%;
  height:250px;        /* altura fixa para todos os vídeos */
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
}

.svp-player-video iframe,
.svp-player-video video {
  width:100%;
  height:100%;
  border:0;
  display:block;
  object-fit:contain;  /* mantém proporção sem cortar */
}

/* Fullscreen placeholder quando iframe está em fullscreen */
.svp-fullscreen-placeholder {
  background: #000;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-size: 1.2rem;
  width: 100%;
  height: 100%;
}

.svp-player-footer {
  background: var(--svp-bg);
  border-top: 1px solid var(--svp-border);
  max-height: calc(100vh - 250px);
  overflow-y: auto;
  flex-shrink: 0;
}

.svp-player-info{padding:1rem;border-bottom:1px solid var(--svp-border)}

.svp-player-actions{display:flex;align-items:center;gap:1rem;margin-top:.75rem}
.svp-player-action{
  display:flex;align-items:center;gap:.5rem;background:var(--svp-hover);
  border:1px solid var(--svp-border);color:var(--svp-text);padding:.5rem 1rem;
  border-radius:20px;font-weight:600;transition:background .2s;cursor:pointer;
}
.svp-player-action:hover{background:var(--svp-chip)}
.svp-player-action.is-liked{background:var(--svp-accent-2);color:#fff;border-color:var(--svp-accent-2)}
.svp-player-action svg{width:18px;height:18px;fill:currentColor}

.svp-comments{padding:1rem;border-bottom:1px solid var(--svp-border)}
.svp-comments-header{font-size:1rem;font-weight:600;margin-bottom:.75rem;color:var(--svp-text)}

.svp-comment-form{display:flex;gap:.5rem;margin-bottom:1rem;}
.svp-comment-input{
  flex:1;border:1px solid var(--svp-border);border-radius:20px;
  padding:.5rem 1rem;background:var(--svp-bg);color:var(--svp-text);font-size:16px;
}

.svp-comment-btn {
  background: var(--svp-accent-2);
  color: #fff;
  border: 0;
  border-radius: 20px;
  padding: .5rem 1rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;
  width: auto;
  cursor: pointer;
} 

.svp-comment{
  display:flex;gap:.75rem;margin-bottom:1rem;padding-bottom:1rem;
  border-bottom:1px solid var(--svp-border);position:relative;
}
.svp-comment:last-child{border-bottom:0}
.svp-comment-avatar{
  width:32px;height:32px;border-radius:50%;background:var(--svp-chip);
  flex:0 0 32px;background-size:cover;background-position:center;
  border:2px solid var(--svp-border);
}
.svp-comment-content{flex:1}
.svp-comment-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.25rem}
.svp-comment-author{font-weight:600;font-size:.9rem;color:var(--svp-text)}
.svp-comment-delete{
  background:transparent;border:0;color:var(--svp-danger);font-size:.8rem;
  padding:.25rem;border-radius:4px;cursor:pointer;opacity:0.7;
}
.svp-comment-delete:hover{opacity:1;background:rgba(239,68,68,0.1)}
.svp-comment-text{color:var(--svp-text);line-height:1.4;margin-bottom:.25rem}
.svp-comment-time{color:var(--svp-sub);font-size:.8rem}

.svp-related{padding:1rem; }
.svp-related-header{font-size:1rem;font-weight:600;margin-bottom:.75rem;color:var(--svp-text)}
.svp-related-grid{display:grid;gap:.75rem}
.svp-related-item{
  display:flex;gap:.75rem;cursor:pointer;padding:.5rem;border-radius:8px;
  transition:background .2s;
}
.svp-related-item:hover{background:var(--svp-hover)}
.svp-related-thumb{
  width:120px;aspect-ratio:16/9;border-radius:8px;object-fit:cover;
  background:var(--svp-chip);flex:0 0 120px;
}
.svp-related-info{flex:1;min-width:0}
.svp-related-title{
  font-weight:600;font-size:.9rem;line-height:1.3;margin-bottom:.25rem;color:var(--svp-text);
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
}
.svp-related-meta{color:var(--svp-sub);font-size:.8rem}

/* Responsivo Desktop */
@media(min-width:768px){
  .svp-overlay{flex-direction:row}
  .svp-player-main{flex:1;display:flex;flex-direction:column}
  .svp-player-sidebar{width:350px;background:var(--svp-elev);border-left:1px solid var(--svp-border)}
  .svp-player-footer{max-height:none;overflow:visible}
  .svp-related{border-top:0}
  .svp-player-video {
    height:400px;
  }
}

.svp-tabs {
  display: flex;
  border-bottom: 1px solid #ddd;
}

.svp-tab-btn {
  flex: 1;
  padding: .75rem;
  background: #f5f5f5;
  border: none;
  cursor: pointer;
  font-weight: 600;
  color: var(--svp-text);
}

.svp-tab-btn.active {
  background: var(--svp-bg);
  border-bottom: 2px solid var(--svp-accent-2);
  color: var(--svp-text);
}

.tab-pane {
  display: none;
  padding: 1rem 0;
}

.tab-pane.active {
  display: block;
}
</style>
</head>
<body>
<div class="svp-app" id="svp-app">
  <!-- Header com navegação -->
  <div class="svp-topbar">
    <div class="svp-header-main">
      
      
      <div class="svp-search" id="svp-search">
        <button id="svp-search-btn" aria-label="Pesquisar">
          <svg viewBox="0 0 24 24"><path d="M9.5 3a6.5 6.5 0 015.164 10.45l4.443 4.443-1.414 1.414-4.443-4.443A6.5 6.5 0 119.5 3zm0 2a4.5 4.5 0 100 9 4.5 4.5 0 000-9z"/></svg>
        </button>
        <input id="svp-search-input" type="search" placeholder="Pesquisar" autocomplete="off" />
        <button style="display:none;" id="svp-clear-btn" aria-label="Limpar">
          <svg viewBox="0 0 24 24"><path d="M18.3 5.71L12 12.01l-6.29-6.3-1.42 1.42 6.3 6.29-6.3 6.29 1.42 1.42L12 14.85l6.29 6.28 1.42-1.41-6.3-6.29 6.3-6.29z"/></svg>
        </button>
      </div>
       
      <div class="svp-nav-btns">
        <button class="svp-nav-btn is-active" data-tab="explore">Explorar</button>
        <button class="svp-nav-btn" data-tab="studio">Estúdio</button>
      </div>
    </div>
    <div class="svp-cats" id="svp-cats"></div>
  </div>

  <!-- Conteúdo principal -->
  <main class="svp-content">
    <!-- Página Explorar -->
    <section class="svp-page is-active" id="svp-page-explore">
      <div class="svp-grid" id="svp-feed"></div>
    </section>

    <!-- Página Meu Estúdio -->
    <section class="svp-page" id="svp-page-studio">
      <div class="svp-studio">
        <div class="svp-form" id="svp-form">
          <div class="svp-row">
            <label for="svp-title">Título</label>
            <input class="svp-input" id="svp-title" type="text" placeholder="Ex.: Highlights Angola vs ..." />
          </div>
          <div class="svp-row">
            <label for="svp-category">Categoria</label>
            <select class="svp-select" id="svp-category"></select>
          </div>
          <div class="svp-row">
            <label for="svp-url">URL do vídeo (YouTube, Facebook público ou MP4)</label>
            <input class="svp-input" id="svp-url" type="url" placeholder="https://..." />
            <div class="svp-hint">Dica: YouTube e Facebook público usam embed; links diretos usam player nativo.</div>
          </div>
          <div class="svp-row">
            <label for="svp-cover">Capa (opcional via ImgBB)</label>
            <input class="svp-file" id="svp-cover" type="file" accept="image/*" />
            <img src="https://pluginicons.craft-cdn.com/icon-pickerbUDwu2AsfAwD2UfXuG1murydJQbPqnvmKcEu.svg?1551792320" class="svp-cover-preview" id="svp-cover-preview" alt="Prévia da capa" />
            <div class="svp-hint">Você pode publicar sem capa. Se enviar, fazemos upload via ImgBB automaticamente.</div>
          </div>
          <button class="svp-btn" id="svp-publish">Publicar vídeo</button>
          <div class="svp-hint" id="svp-publish-hint"></div>
        </div>

        <div class="svp-mylist">
          <h3>Meus vídeos</h3>
          <div id="svp-myfeed"></div>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- Player Overlay com Iframe Fullscreen Nativo -->
<div class="svp-overlay" id="svp-overlay">
  <div class="svp-player-main">
    <!-- Header do player -->
    <div class="svp-player-header">
      <div class="svp-player-title-wrap">
        <div class="svp-player-title-main" id="svp-player-title">Carregando...</div>
        <div class="svp-player-meta" id="svp-player-meta">0 visualizações</div>
      </div>
      <div class="svp-player-controls">
        <button class="svp-player-btn" id="svp-fullscreen" title="Tela cheia" aria-label="Tela cheia">
          <svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm12 5h-5v-2h3v-3h2v5zM7 7h3V5H5v5h2V7zm12 3V5h-5v2h3v3h2z"/></svg>
        </button>
        <button class="svp-player-btn" id="svp-close" aria-label="Fechar">
          <svg viewBox="0 0 24 24"><path d="M18.3 5.71L12 12.01l-6.29-6.3-1.42 1.42 6.3 6.29-6.3 6.29 1.42 1.42L12 14.85l6.29 6.28 1.42-1.41-6.3-6.29 6.3-6.29z"/></svg>
        </button>
      </div>
    </div>

    <!-- Área do vídeo com tamanho consistente -->
    <div class="svp-player-video" id="svp-player-body"></div>

    <!-- Informações e comentários -->
    <div class="svp-player-footer">
      <div class="svp-player-info">
        <div class="svp-player-actions">
          <button class="svp-player-action" id="svp-player-like" aria-label="Curtir">
            <svg viewBox="0 0 24 24"><path d="M12.1 8.64l-.1.1-.11-.11C10.14 6.82 7.1 7.24 5.5 9c-1.61 1.76-1.45 4.45.36 6.17l5.86 5.66 5.86-5.66c1.81-1.72 1.97-4.41.36-6.17-1.6-1.76-4.64-2.18-6.34-.36z"/></svg>
            <span id="svp-player-like-count">0</span>
          </button>
        </div>
      </div>

     <!-- Abas -->
<div class="svp-tabs">
  <button class="svp-tab-btn active" data-tab="related">Vídeos relacionados</button>
  <button class="svp-tab-btn" data-tab="comments">Comentários</button>
</div>

<!-- Conteúdo das abas -->
<div class="svp-tab-content">

  <!-- Vídeos relacionados (aba inicial visível) -->
  <div class="svp-related tab-pane active" id="tab-related">
    <div class="svp-related-header">Vídeos relacionados</div>
    <div class="svp-related-grid" id="svp-related-videos"></div>
  </div>

  <!-- Comentários (aba oculta no início) -->
  <div class="svp-comments tab-pane" id="tab-comments">
    <div class="svp-comments-header">Comentários</div>
    <div class="svp-comment-form">
      <input class="svp-comment-input" id="svp-comment-input" type="text" placeholder="Adicione um comentário..." />
      <button class="svp-comment-btn" id="svp-comment-btn">
        <svg xmlns="http://www.w3.org/2000/svg"
             viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"
             style="width:24px;height:24px">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 19V5"/>
          <path stroke-linecap="round" stroke-linejoin="round" d="M5 12l7-7 7 7"/>
        </svg>
      </button>
    </div>
    <div id="svp-comments-list"></div>
  </div>

</div>
    </div>
  </div>
</div>

<script type="module">
/* ===== Firebase SDKs ===== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithRedirect, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
import {
  getDatabase, ref, onValue, push, update, remove, runTransaction, serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

/* ===== Configs do projeto ===== */
const firebaseConfig = {
  apiKey: "AIzaSyCE_vGty5XsV1YqdCi49Ck2xJDSFq284wc",
  authDomain: "cliente-movicel.firebaseapp.com",
  databaseURL: "https://cliente-movicel-default-rtdb.firebaseio.com",
  projectId: "cliente-movicel",
  storageBucket: "cliente-movicel.firebasestorage.app",
  messagingSenderId: "215414688375",
  appId: "1:215414688375:web:2c7d20a0c03c4c0fcfd472",
  measurementId: "G-7F1RGP9GHV"
};
const apiKeyImgBB = "e073e02267a1f0259cd69c562e780659";

/* ===== Inicialização ===== */
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

/* ===== Estado & referências ===== */
const state = {
  user: null,
  videos: [],
  myVideos: [],
  comments: {},
  q: "",
  cat: "Todos",
  cats: ["Todos","Música","Notícias","Esportes","Entretenimento","Educação","Comédia","Tecnologia","Gaming"],
  originalContainer: null,  // para restaurar iframe
  isFullscreen: false
};

/* ===== Util: SVGs inline ===== */
const Icons = {
  like: '<svg viewBox="0 0 24 24"><path d="M12.1 8.64l-.1.1-.11-.11C10.14 6.82 7.1 7.24 5.5 9c-1.61 1.76-1.45 4.45.36 6.17l5.86 5.66 5.86-5.66c1.81-1.72 1.97-4.41.36-6.17-1.6-1.76-4.64-2.18-6.34-.36z"/></svg>',
  liked: '<svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 6 4 4 6.5 4c1.74 0 3.41.81 4.5 2.09C12.09 4.81 13.76 4 15.5 4 18 4 20 6 20 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" /></svg>',
  delete: '<svg viewBox="0 0 24 24"><path d="M6 19a2 2 0 002 2h8a2 2 0 002-2V7H6v12zM8 4h8l1 1h3v2H4V5h3l1-1z"/></svg>',
  views: '<svg style="width:16px; height:16px;" viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" /></svg>',
  play: '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>'
};

/* ===== Helpers ===== */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

function sanitize(str){return (str||"").trim()}
function byDateDesc(a,b){return (b.createdAt||0)-(a.createdAt||0)}
function matchQuery(item,q){ if(!q) return true; q=q.toLowerCase(); return (item.title||"").toLowerCase().includes(q) || (item.authorName||"").toLowerCase().includes(q); }
function matchCat(item,cat){ if(cat==="Todos") return true; return (item.category||"")===cat; }

/* YouTube/Facebook parsing */
function parseYouTubeId(url){
  try{
    const u=new URL(url);
    if(u.hostname.includes("youtu.be")) return u.pathname.slice(1);
    if(u.searchParams.get("v")) return u.searchParams.get("v");
    if(u.pathname.includes("/shorts/")) return u.pathname.split("/shorts/")[1].split("?")[0];
  }catch(e){}
  const m = url.match(/(?:v=|\/)([0-9A-Za-z_-]{11})/);
  return m?m[1]:null;
}
function isFacebookUrl(url){ return /facebook\.com/.test(url) }

/* ImgBB upload */
async function uploadToImgBB(file){
  const hint = $("#svp-publish-hint");
  hint.textContent = "Enviando capa para ImgBB…";
  const base64 = await new Promise((res,rej)=>{
    const fr = new FileReader();
    fr.onload = () => res(fr.result.split(",")[1]);
    fr.onerror = rej;
    fr.readAsDataURL(file);
  });
  const fd = new FormData();
  fd.append("image", base64);
  const r = await fetch(`https://api.imgbb.com/1/upload?key=${apiKeyImgBB}`, { method:"POST", body:fd });
  const json = await r.json();
  if(!json.success) throw new Error("Falha ao enviar capa");
  hint.textContent = "Capa enviada com sucesso.";
  return json.data?.url || json.data?.display_url;
}

/* Auth */
function ensureAuth(){
  if(!auth.currentUser){
    const provider = new GoogleAuthProvider();
    signInWithRedirect(auth, provider).catch(()=>{});
  }
}

/* ===== Avatar real do Firebase Auth ===== */
function getUserAvatar(user){
  if(user && user.photoURL){
    return user.photoURL;
  }
  return generateAvatar(user?.uid || 'default');
}

function getAuthorAvatar(authorId, authorPhotoURL){
  if(authorPhotoURL){
    return authorPhotoURL;
  }
  return generateAvatar(authorId);
}

function generateAvatar(uid="x"){
  const c = ["#ff6b6b","#feca57","#1dd1a1","#54a0ff","#5f27cd","#ee5253"];
  const i = uid.split("").reduce((a,ch)=>a+ch.charCodeAt(0),0) % c.length;
  const col = encodeURIComponent(c[i]);
  return `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><circle cx='32' cy='32' r='30' fill='${col}'/><circle cx='32' cy='24' r='8' fill='white'/><path d='M32 36c-8 0-15 4-15 8v4h30v-4c0-4-7-8-15-8z' fill='white'/></svg>`;
}

/* ===== UI dinâmico ===== */
function renderCategories(){
  const cats = state.cats;
  const sel = $("#svp-category");
  sel.innerHTML = cats.filter(c=>c!=="Todos").map(c=>`<option value="${c}">${c}</option>`).join("");
  if(!sel.value) sel.value = "Entretenimento";
  const wrap = $("#svp-cats");
  wrap.innerHTML = cats.map(c=>`<button class="svp-chip ${state.cat===c?"is-active":""}" data-cat="${c}">${c}</button>`).join("");
}

function renderFeed(){
  const list = state.videos.filter(v => matchQuery(v, state.q) && matchCat(v, state.cat)).sort(byDateDesc);
  const el = $("#svp-feed");
  el.innerHTML = list.map(cardHTML).join("") || `<div class="svp-empty">Nada encontrado.</div>`;
}
function renderMyFeed(){
  const my = state.videos.filter(v=> v.authorId===state.user?.uid).sort(byDateDesc);
  state.myVideos = my;
  const el = $("#svp-myfeed");
  el.innerHTML = my.length ? my.map(cardHTML).join("") : `<div class="svp-empty">Você ainda não publicou vídeos.</div>`;
}

/* Card HTML */
function cardHTML(v){
  const cover = v.coverUrl || thumbFromVideo(v);
  const youId = parseYouTubeId(v.url);
  const durationBadge = youId ? "YouTube" : (isFacebookUrl(v.url) ? "Facebook" : "Vídeo");
  const liked = !!(v.likesBy && state.user && v.likesBy[state.user.uid]);
  const authorAvatar = getAuthorAvatar(v.authorId, v.authorPhotoURL);
  
  return `
  <article class="svp-card" data-id="${v.id}">
    <div class="svp-thumb-wrap" data-id="${v.id}" data-action="open">
      <img class="svp-thumb" src="${cover}" alt="${escapeHtml(v.title)}" />
      <div class="svp-dur">${durationBadge}</div>
    </div>
    <div class="svp-meta">
      <div class="svp-avatar" style="background-image:url('${authorAvatar}')"></div>
      <div class="svp-info">
        <h4 class="svp-title">${escapeHtml(v.title)}</h4>
        <div class="svp-sub">${escapeHtml(v.authorName||"")} • ${escapeHtml(v.category||"")} • ${Icons.views} ${v.views||0}</div>
        <div class="svp-actions">
          <button class="svp-action ${liked?"is-like":""}" data-action="like" data-id="${v.id}" aria-label="Curtir">
            ${liked?Icons.liked:Icons.like} <span>${(v.likesCount||0)}</span>
          </button>
          ${state.user?.uid===v.authorId?`
          <button class="svp-action is-danger" data-action="delete" data-id="${v.id}" aria-label="Apagar">${Icons.delete} Apagar</button>
          `:""}
        </div>
      </div>
    </div>
  </article>
  `;
}

/* Inferir thumb se não houver capa */
function thumbFromVideo(v){
  const youId = parseYouTubeId(v.url);
  if(youId) return `https://i.ytimg.com/vi/${youId}/hqdefault.jpg`;
  if(isFacebookUrl(v.url)) return "https://static.xx.fbcdn.net/rsrc.php/yV/r/B8q7QmN8QSh.svg";
  return "data:image/svg+xml;charset=UTF-8," + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='640' height='360'><rect width='100%' height='100%' fill='#ddd'/><polygon points='260,180 260,120 340,150' fill='#666'/></svg>`);
}

/* Escape HTML */
function escapeHtml(s){return (s||"").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;" }[m]))}

/* ===== Player Overlay Tela Cheia ===== */
let currentVideo = null;
function openPlayer(v){
  currentVideo = v;
  $("#svp-player-title").textContent = v.title || "Carregando...";
  $("#svp-player-meta").textContent = `${v.views||0} visualizações • ${v.authorName||""} • ${v.category||""}`;
  
  const body = $("#svp-player-body");
  body.innerHTML = buildPlayerHTML(v);
  
  updatePlayerLikeButton(v);
  loadComments(v.id);
  loadRelatedVideos(v);
  
  $("#svp-overlay").classList.add("is-open");
  document.body.style.overflow = 'hidden';
  
  runTransaction(ref(db, `videos/${v.id}/views`), curr => (curr||0)+1);
}

function closePlayer(){
  // Restaurar iframe se estiver em fullscreen
  if (state.isFullscreen) {
    exitFullscreen();
  }
  
  $("#svp-overlay").classList.remove("is-open");
  $("#svp-player-body").innerHTML = "";
  $("#svp-comments-list").innerHTML = "";
  $("#svp-related-videos").innerHTML = "";
  document.body.style.overflow = '';
  
  currentVideo = null;
}

function buildPlayerHTML(v){
  const youId = parseYouTubeId(v.url);
  if(youId){
    const src = `https://www.youtube.com/embed/${youId}?autoplay=1&rel=0&modestbranding=1&iv_load_policy=3`;
    return `<iframe 
  id="video-iframe"
  src="${src}"
  frameborder="0"
  allow="autoplay; encrypted-media; picture-in-picture"
  allowfullscreen></iframe>`;}
  if(isFacebookUrl(v.url)){
    const enc = encodeURIComponent(v.url);
    const src = `https://www.facebook.com/plugins/video.php?href=${enc}&show_text=false&autoplay=true`;
    return `<iframe
  id="video-iframe"
  src="${src}"
  frameborder="0"
  allow="autoplay; encrypted-media; picture-in-picture"
  allowfullscreen></iframe>`;  }
  return `<video id="video-iframe" src="${v.url}" controls autoplay playsinline></video>`;
}

function updatePlayerLikeButton(v){
  const liked = !!(v.likesBy && state.user && v.likesBy[state.user.uid]);
  const btn = $("#svp-player-like");
  btn.className = `svp-player-action ${liked?"is-liked":""}`;
  btn.innerHTML = `
    <svg viewBox="0 0 24 24"><path d="${liked ? "M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 6 4 4 6.5 4c1.74 0 3.41.81 4.5 2.09C12.09 4.81 13.76 4 15.5 4 18 4 20 6 20 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" : "M12.1 8.64l-.1.1-.11-.11C10.14 6.82 7.1 7.24 5.5 9c-1.61 1.76-1.45 4.45.36 6.17l5.86 5.66 5.86-5.66c1.81-1.72 1.97-4.41.36-6.17-1.6-1.76-4.64-2.18-6.34-.36z"}"/></svg>
    <span>${v.likesCount||0}</span>
  `;
}

function loadComments(videoId){
  onValue(ref(db, `comments/${videoId}`), snap => {
    const comments = [];
    snap.forEach(child => {
      comments.push({ id: child.key, ...child.val() });
    });
    renderComments(comments.sort(byDateDesc));
  });
}

function renderComments(comments){
  const list = $("#svp-comments-list");
  list.innerHTML = comments.map(comment => {
    const commentAvatar = getAuthorAvatar(comment.authorId, comment.authorPhotoURL);
    const canDelete = state.user && state.user.uid === comment.authorId;
    return `
    <div class="svp-comment">
      <div class="svp-comment-avatar" style="background-image:url('${commentAvatar}')"></div>
      <div class="svp-comment-content">
        <div class="svp-comment-header">
          <div class="svp-comment-author">${escapeHtml(comment.authorName||"")}</div>
          ${canDelete ? `<button class="svp-comment-delete" data-action="delete-comment" data-comment-id="${comment.id}" data-video-id="${currentVideo?.id}" title="Apagar comentário">×</button>` : ''}
        </div>
        <div class="svp-comment-text">${escapeHtml(comment.text||"")}</div>
        <div class="svp-comment-time">${timeAgo(comment.createdAt)}</div>
      </div>
    </div>
  `}).join("") || '<div class="svp-empty">Seja o primeiro a comentar!</div>';
}

function loadRelatedVideos(currentVideo){
  const related = state.videos
    .filter(v => v.id !== currentVideo.id && v.category === currentVideo.category)
    .sort(byDateDesc)
    .slice(0, 10);
  
  const container = $("#svp-related-videos");
  container.innerHTML = related.map(v => `
    <div class="svp-related-item" data-id="${v.id}" data-action="open-related">
      <img class="svp-related-thumb" src="${v.coverUrl || thumbFromVideo(v)}" alt="${escapeHtml(v.title)}" />
      <div class="svp-related-info">
        <div class="svp-related-title">${escapeHtml(v.title)}</div>
        <div class="svp-related-meta">${escapeHtml(v.authorName||"")} • ${v.views||0} visualizações</div>
      </div>
    </div>
  `).join("") || '<div class="svp-empty">Nenhum vídeo relacionado encontrado.</div>';
}

function timeAgo(timestamp){
  if(!timestamp) return "";
  const diff = Date.now() - timestamp;
  const minutes = Math.floor(diff / 60000);
  const hours = Math.floor(diff / 3600000);
  const days = Math.floor(diff / 86400000);
  
  if(days > 0) return `${days} dia${days>1?'s':''} atrás`;
  if(hours > 0) return `${hours} hora${hours>1?'s':''} atrás`;
  if(minutes > 0) return `${minutes} minuto${minutes>1?'s':''} atrás`;
  return 'Agora';
}

// Fullscreen nativo - EXTRAIR IFRAME DO CONTAINER
function requestFullscreen(){
  const iframe = $("#video-iframe");
  if (!iframe) {
    console.log('Iframe não encontrado');
    return;
  }

  try {
    // Salvar container original
    state.originalContainer = iframe.parentNode;
    state.isFullscreen = true;

    // Colocar iframe diretamente em fullscreen
    if (iframe.requestFullscreen) {
      iframe.requestFullscreen().then(() => {
        console.log('Iframe em fullscreen');
      }).catch(err => {
        console.error('Erro fullscreen:', err);
        // Fallback: tentar colocar iframe temporariamente em body
        tryFallbackFullscreen(iframe);
      });
    } else if (iframe.webkitRequestFullscreen) {
      iframe.webkitRequestFullscreen();
    } else if (iframe.mozRequestFullScreen) {
      iframe.mozRequestFullScreen();
    } else if (iframe.msRequestFullscreen) {
      iframe.msRequestFullscreen();
    } else {
      // Fallback para browsers que não suportam
      tryFallbackFullscreen(iframe);
    }
  } catch (error) {
    console.error('Erro ao entrar em tela cheia:', error);
    tryFallbackFullscreen(iframe);
  }
}

function tryFallbackFullscreen(iframe) {
  // Criar container temporário em fullscreen
  const fullscreenContainer = document.createElement('div');
  fullscreenContainer.id = 'fullscreen-container';
  fullscreenContainer.style.cssText = `
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    background: #000;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
  `;
  
  // Botão de fechar
  const closeBtn = document.createElement('button');
  closeBtn.innerHTML = '×';
  closeBtn.style.cssText = `
    position: absolute;
    top: 20px; right: 20px;
    background: rgba(255,255,255,0.8);
    border: 0;
    border-radius: 50%;
    width: 40px; height: 40px;
    font-size: 24px;
    cursor: pointer;
    z-index: 10001;
  `;
  closeBtn.onclick = exitFullscreen;
  
  // Mover iframe para container fullscreen
  iframe.style.cssText = 'width: 100%; height: 100%; border: 0;';
  fullscreenContainer.appendChild(closeBtn);
  fullscreenContainer.appendChild(iframe);
  document.body.appendChild(fullscreenContainer);
  
  console.log('Fallback fullscreen ativado');
}

function exitFullscreen(){
  try {
    state.isFullscreen = false;
    
    // Verificar se há container customizado
    const customContainer = $("#fullscreen-container");
    if (customContainer) {
      const iframe = customContainer.querySelector('#video-iframe');
      if (iframe && state.originalContainer) {
        // Restaurar estilos originais
        iframe.style.cssText = 'width:100%;height:100%;border:0;display:block;object-fit:contain;';
        state.originalContainer.appendChild(iframe);
      }
      customContainer.remove();
      return;
    }
    
    // Sair de fullscreen nativo
    if (document.exitFullscreen) {
      document.exitFullscreen().catch(console.error);
    } else if (document.webkitExitFullscreen) {
      document.webkitExitFullscreen();
    } else if (document.mozCancelFullScreen) {
      document.mozCancelFullScreen();
    } else if (document.msExitFullscreen) {
      document.msExitFullscreen();
    }
  } catch (error) {
    console.error('Erro ao sair da tela cheia:', error);
  }
}

// Detectar mudanças de fullscreen
document.addEventListener('fullscreenchange', handleFullscreenChange);
document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
document.addEventListener('mozfullscreenchange', handleFullscreenChange);
document.addEventListener('MSFullscreenChange', handleFullscreenChange);

function handleFullscreenChange() {
  const isFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement);
  
  if (!isFullscreen && state.isFullscreen) {
    // Saiu de fullscreen, restaurar iframe
    const iframe = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.querySelector('#video-iframe');
    if (iframe && state.originalContainer) {
      iframe.style.cssText = 'width:100%;height:100%;border:0;display:block;object-fit:contain;';
      state.originalContainer.appendChild(iframe);
    }
    state.isFullscreen = false;
  }
  
  console.log('Fullscreen status:', isFullscreen);
}

/* ===== Eventos ===== */
// Navegação no header
$$(".svp-nav-btn").forEach(btn => {
  btn.addEventListener("click", ()=>{
    const tab = btn.dataset.tab;
    $$(".svp-nav-btn").forEach(b=> b.classList.toggle("is-active", b.dataset.tab===tab));
    $$(".svp-page").forEach(p=> p.classList.toggle("is-active", p.id === `svp-page-${tab}`));
  });
});

// Categorias
$("#svp-cats").addEventListener("click",(e)=>{
  const chip = e.target.closest(".svp-chip");
  if(!chip) return;
  state.cat = chip.dataset.cat;
  renderCategories();
  renderFeed();
});

// Busca
$("#svp-search-input").addEventListener("input", debounce(()=>{
  state.q = sanitize($("#svp-search-input").value);
  renderFeed();
}, 120));
$("#svp-clear-btn").addEventListener("click", ()=>{
  $("#svp-search-input").value = "";
  state.q = "";
  renderFeed();
});

// Ações do feed
document.body.addEventListener("click",(e)=>{
  const open = e.target.closest('[data-action="open"]');
  const openRelated = e.target.closest('[data-action="open-related"]');
  const like = e.target.closest('[data-action="like"]');
  const del = e.target.closest('[data-action="delete"]');
  const delComment = e.target.closest('[data-action="delete-comment"]');

  if(open){
    const id = open.dataset.id;
    const v = state.videos.find(x=>x.id===id);
    if(v) openPlayer(v);
  }
  if(openRelated){
    const id = openRelated.dataset.id;
    const v = state.videos.find(x=>x.id===id);
    if(v) openPlayer(v);
  }
  if(like){
    const id = like.dataset.id;
    toggleLike(id).catch(()=>{});
  }
  if(del){
    const id = del.dataset.id;
    deleteVideo(id);
  }
  if(delComment){
    const commentId = delComment.dataset.commentId;
    const videoId = delComment.dataset.videoId;
    deleteComment(commentId, videoId);
  }
});

// Player
$("#svp-close").addEventListener("click", closePlayer);
$("#svp-fullscreen").addEventListener("click", requestFullscreen);
$("#svp-player-like").addEventListener("click", ()=>{
  if(currentVideo) toggleLike(currentVideo.id).catch(()=>{});
});

// Comentários
$("#svp-comment-btn").addEventListener("click", async ()=>{
  ensureAuth();
  const user = auth.currentUser;
  const text = sanitize($("#svp-comment-input").value);
  
  if(!user || !currentVideo || !text) return;
  
  const data = {
    text,
    authorId: user.uid,
    authorName: user.displayName || user.email || "Usuário",
    authorPhotoURL: user.photoURL || null,
    createdAt: Date.now()
  };
  
  await push(ref(db, `comments/${currentVideo.id}`), data);
  $("#svp-comment-input").value = "";
});

// Publicação
const coverInput = $("#svp-cover");
const coverPreview = $("#svp-cover-preview");
coverInput.addEventListener("change", ()=>{
  const f = coverInput.files?.[0];
  if(f){ coverPreview.src = URL.createObjectURL(f); }
  else { coverPreview.removeAttribute("src"); }
});

$("#svp-publish").addEventListener("click", async ()=>{
  ensureAuth();
  const user = auth.currentUser;
  const title = sanitize($("#svp-title").value);
  const category = $("#svp-category").value;
  const url = sanitize($("#svp-url").value);
  const hint = $("#svp-publish-hint");

  if(!user){ hint.textContent="Autenticando… tente novamente."; return; }
  if(!title || !category || !url){ hint.textContent="Preencha título, categoria e URL."; return; }

  try{
    let coverUrl = "";
    const f = coverInput.files?.[0];
    if(f){ coverUrl = await uploadToImgBB(f); }
    const data = {
      title, category, url, coverUrl,
      authorId: user.uid,
      authorName: user.displayName || user.email || "Autor",
      authorPhotoURL: user.photoURL || null,
      createdAt: Date.now(),
      likesCount: 0,
      views: 0
    };
    await push(ref(db, "videos"), data);
    hint.textContent = "Publicado com sucesso!";
    $("#svp-title").value = "";
    $("#svp-url").value = "";
    coverInput.value = "";
    coverPreview.removeAttribute("src");
  }catch(err){
    hint.textContent = "Erro ao publicar. Verifique o link e tente novamente.";
  }
});

/* Like/Unlike */
async function toggleLike(id){
  const user = auth.currentUser;
  if(!user){ ensureAuth(); return; }
  const v = state.videos.find(x=>x.id===id);
  if(!v) return;
  const liked = !!(v.likesBy && v.likesBy[user.uid]);

  await runTransaction(ref(db, `videos/${id}/likesCount`), curr => {
    if(liked){ return Math.max((curr||0)-1, 0); }
    return (curr||0)+1;
  });
  await update(ref(db, `videos/${id}`), {
    [`likesBy/${user.uid}`]: liked ? null : true
  });
}

/* Apagar comentário */
async function deleteComment(commentId, videoId) {
  if (!commentId || !videoId) return;
  
  showConfirmDialog("Tem certeza que deseja apagar este comentário?", async () => {
    try {
      await remove(ref(db, `comments/${videoId}/${commentId}`));
    } catch (err) {
      console.error("Erro ao deletar comentário:", err);
    }
  });
}

function showConfirmDialog(message, onConfirm) {
  const modal = document.createElement('div');
  modal.style.cssText = `
    position:fixed;top:0;left:0;right:0;bottom:0;
    background:rgba(0,0,0,0.5);
    display:flex;align-items:center;justify-content:center;
    z-index:9999
  `;

  modal.innerHTML = `
    <div style="background:white;padding:1.5rem;border-radius:12px;
                box-shadow:0 4px 20px rgba(0,0,0,0.3);
                max-width:400px;width:90%;margin:1rem">
      <p style="color:#333;margin-bottom:1rem;font-size:1rem">${message}</p>
      <div style="display:flex;justify-content:flex-end;gap:0.75rem">
        <button class="confirm-cancel"
          style="padding:0.5rem 1rem;color:#666;background:transparent;
                 border:1px solid #ddd;border-radius:6px;cursor:pointer">
          Cancelar
        </button>
        <button class="confirm-yes"
          style="padding:0.5rem 1rem;background:#ef4444;color:white;
                 border:0;border-radius:6px;cursor:pointer;font-weight:600">
          Confirmar
        </button>
      </div>
    </div>
  `;

  document.body.appendChild(modal);

  const cancelBtn = modal.querySelector('.confirm-cancel');
  const yesBtn = modal.querySelector('.confirm-yes');

  cancelBtn.addEventListener('click', () => modal.remove());

  yesBtn.addEventListener('click', () => {
    modal.remove();
    if (typeof onConfirm === 'function') {
      try {
        const result = onConfirm();
        if (result instanceof Promise) {
          result.catch(err => {
            console.error("Erro ao confirmar:", err);
          });
        }
      } catch (err) {
        console.error("Erro ao confirmar:", err);
      }
    }
  });
}

async function deleteVideo(id) {
  const v = state.videos.find(x => x.id === id);
  if (!v || state.user?.uid !== v.authorId) return;

  showConfirmDialog("Tem certeza que deseja apagar este vídeo?", async () => {
    try {
      await remove(ref(db, `videos/${id}`));
      await remove(ref(db, `comments/${id}`));
    } catch (err) {
      console.error("Erro ao deletar:", err);
    }
  });
}

/* Realtime */
onValue(ref(db, "videos"), snap=>{
  const items = [];
  snap.forEach(child=>{
    const val = child.val()||{};
    items.push({ id: child.key, ...val });
  });
  state.videos = items;
  renderFeed();
  renderMyFeed();
  
  if(currentVideo){
    const updatedVideo = items.find(v => v.id === currentVideo.id);
    if(updatedVideo){
      updatePlayerLikeButton(updatedVideo);
      currentVideo = updatedVideo;
    }
  }
});

onAuthStateChanged(auth, user=>{
  state.user = user;
  renderFeed(); 
  renderMyFeed();
});
ensureAuth();

renderCategories();

function debounce(fn,ms){
  let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args),ms); };
}
</script>
      <script>
  document.addEventListener("DOMContentLoaded", () => {
    const tabButtons = document.querySelectorAll(".svp-tab-btn");
    const tabPanes = document.querySelectorAll(".tab-pane");

    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        // remove active de todos os botões e conteúdos
        tabButtons.forEach(b => b.classList.remove("active"));
        tabPanes.forEach(p => p.classList.remove("active"));

        // ativa o botão clicado
        btn.classList.add("active");

        // ativa o conteúdo correspondente
        const target = document.getElementById("tab-" + btn.dataset.tab);
        if (target) {
          target.classList.add("active");
        }
      });
    });
  });
</script>
  <script>
// Toast simples
function showToast(msg) {
  const t = document.createElement("div");
  t.textContent = msg;
  Object.assign(t.style, {
    position:"fixed", bottom:"20px", left:"50%",
    transform:"translateX(-50%)",
    background:"rgba(0,0,0,0.85)", color:"#fff",
    padding:"8px 14px", borderRadius:"6px",
    fontSize:"14px", zIndex:99999,
    opacity:"0", transition:"opacity .3s"
  });
  document.body.appendChild(t);
  requestAnimationFrame(()=> t.style.opacity="1");
  setTimeout(()=>{ t.style.opacity="0"; setTimeout(()=>t.remove(),300); },2000);
}

// Sai do pseudo fullscreen
function exitFullscreen() {
  document.getElementById("svp-overlay")?.classList.remove("is-fs");
  showToast("Clique no X pra sair");
  removeFsCloseButton();

  // 🔹 Chamada para o Android voltar ao retrato
  if (window.AndroidInterface && AndroidInterface.exitFullscreen) {
    AndroidInterface.exitFullscreen();
  }
}

// Cria botão ✕ de fullscreen
function addFsCloseButton() {
  if (document.getElementById("svp-fs-close")) return;

  const closeBtn = document.createElement('button');
  closeBtn.id = "svp-fs-close";
  closeBtn.innerHTML = '';
  closeBtn.style.cssText = `
    position: fixed;
    top: 25px; right: 25px;
    background: transparent;
    color: white;
    border: 0px solid transparent;
    border-radius: 50%;
    width: 40px; height: 40px;
    font-size: 20px;
    cursor: pointer;
    z-index: 10001;
    display: flex; align-items: center; justify-content: center;
  `;
  closeBtn.onclick = exitFullscreen;
  document.body.appendChild(closeBtn);
}

function removeFsCloseButton() {
  const btn = document.getElementById("svp-fs-close");
  if (btn) btn.remove();
}

// Liga os botões
document.addEventListener("DOMContentLoaded", () => {
  const fsBtn = document.getElementById("svp-fullscreen");
  const overlayCloseBtn = document.getElementById("svp-close");

  if (fsBtn) {
    fsBtn.addEventListener("click", () => {
      // aqui você pode também adicionar a classe .is-fs no overlay
      showToast("Tela cheia");
      addFsCloseButton();

      // 🔹 Chamada para o Android forçar landscape
      if (window.AndroidInterface && AndroidInterface.enterFullscreen) {
        AndroidInterface.enterFullscreen();
      }
    });
  }

  if (overlayCloseBtn) {
    overlayCloseBtn.addEventListener("click", () => {
      // fecha o overlay inteiro, sem toast de fullscreen
      closePlayer && closePlayer();
    });
  }
});
</script>
</body>
</html>