<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reels App</title>
    <style>
       :root {
    --primary-color: #4a90e2; /* tom azul claro */
    --bg-color: #ffffff; /* fundo branco */
    --surface-color: #f5f5f5; /* cor de superf√≠cie clara */
    --text-color: #1a1a1a; /* texto escuro */
    --text-secondary: #555555; /* texto secund√°rio mais claro */
    --border-color: #cccccc; /* bordas claras */
    --success-color: #10b981; /* verde */
    --error-color: #ef4444; /* vermelho */
    --heart-color: #ff3040; /* vermelho vivo para √≠cone cora√ß√£o */
}


        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow-x: hidden;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 16px;
            z-index: 100;
        }

        .header-title {
            font-size: 20px;
            font-weight: bold;
            margin-right: auto;
        }

        .search-container {
            flex: 1;
            max-width: 300px;
            margin: 0 16px;
            position: relative;
        }

        /* Input melhorado */
.search-input-advanced {
    flex: 1;
    padding: 12px 8px;
    border: none;
    background: transparent;
    color: var(--text-color);
    font-size: 16px;
    outline: none;
}

.search-input-advanced::placeholder {
    color: var(--text-secondary);
}

/* Bot√£o limpar */
.clear-search {
    padding: 8px 12px;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 16px;
    transition: color 0.3s;
}

.clear-search:hover {
    color: var(--error-color);
}

        .add-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 16px;
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-left: 16px;
            gap: 8px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
        }

        /* Tabs */
        .tabs-container {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            height: 50px;
            background-color: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            z-index: 99;
        }

        .tab {
            flex: 1;
            height: 100%;
            border: none;
            background: none;
            color: var(--text-secondary);
            font-size: 16px;
            cursor: pointer;
            position: relative;
            transition: color 0.3s;
        }

        .tab.active {
            color: var(--primary-color);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--primary-color);
        }

        /* Main Content */
        .main-content {
            margin-top: 110px;
            padding: 16px;
            min-height: calc(100vh - 110px);
        }

        /* Feed Grid */
        .feed-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        /* Reel Card */
        .reel-card {
            background-color: var(--surface-color);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid var(--border-color);
        }

        .reel-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .reel-thumbnail {
            width: 100%;
            height: 200px;
            background-color: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .reel-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .reel-thumbnail video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .play-icon {
            position: absolute;
            width: 50px;
            height: 50px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .type-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .type-badge.video {
            background-color: #ff4757;
        }

        .type-badge.image {
            background-color: #2ed573;
        }

        .reel-info {
            padding: 12px;
        }

        .reel-title {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .reel-author {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .reel-author img {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            object-fit: cover;
        }

        .reel-author-name {
            font-size: 13px;
            color: #f5f5f5;
        }

        .reel-genre {
            display: inline-block;
            padding: 2px 8px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px;
            font-size: 11px;
            margin-bottom: 8px;
        }

        .reel-stats {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--text-color);
        }

        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal Base */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--surface-color);
            border-radius: 12px;
            padding: 24px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
        }

        /* Create Modal */
        .create-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-width: 400px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 500;
            color: var(--text-color);
        }

        .form-input {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            border-color: var(--primary-color);
        }

        .form-select {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 16px;
            outline: none;
        }

        .upload-type-tabs {
            display: flex;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .upload-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background-color: var(--bg-color);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-tab.active {
            background-color: var(--primary-color);
            color: white;
        }

        .file-upload {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .file-upload:hover {
            border-color: var(--primary-color);
        }

        .file-upload.dragover {
            border-color: var(--primary-color);
            background-color: rgba(93, 92, 222, 0.1);
        }

        .upload-icon {
            font-size: 48px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .submit-btn {
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .submit-btn:hover {
            background-color: #4c4bcd;
        }

        .submit-btn:disabled {
            background-color: var(--border-color);
            cursor: not-allowed;
        }

/* Adicione apenas isto ao seu CSS existente */
/* SUBSTITUA todo o CSS de transi√ß√£o por este simples: */
.fullscreen-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #000;
    z-index: 2000;
    display: none;
    flex-direction: column;
    /* SEM transi√ß√µes complexas */
}

/* Efeito suave apenas no conte√∫do */
.overlay-content {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    padding: 60px 20px 150px 20px;
    transition: opacity 0.3s ease; /* Apenas fade suave */
}

/* Estado durante carregamento */
.overlay-content.loading {
    opacity: 0.7;
}
        .overlay-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            display: flex;
            align-items: center;
            padding: 0 16px;
            z-index: 10;
        }

        .overlay-type {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            margin-right: auto;
        }

        .overlay-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
        }

        /* Player de v√≠deo fullscreen maior */
.overlay-content {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    padding: 60px 20px 150px 20px; /* Espa√ßo para header e info */
}

.overlay-media {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

/* Classe especial para v√≠deos - MUITO MAIOR */
.overlay-media.video-player {
    width: 95vw;           /* 95% da largura da tela */
    height: 80vh;          /* 80% da altura da tela */
    max-width: 1200px;     /* M√°ximo 1200px no desktop */
    max-height: 675px;     /* Propor√ß√£o 16:9 para 1200px */
    border-radius: 12px;   /* Bordas arredondadas */
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5); /* Sombra bonita */
}

/* Responsivo para mobile - AINDA MAIOR */
@media (max-width: 768px) {
    .overlay-content {
        padding: 60px 10px 120px 10px; /* Menos padding lateral */
    }
/* ADICIONE estes estilos para os bot√µes de navega√ß√£o: */


/* Bot√µes de navega√ß√£o */
.nav-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    background-color: rgba(0, 0, 0, 0.6);
    color: white;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    pointer-events: auto; /* Reativa cliques nos bot√µes */
    opacity: 0.7;
    margin: 0 20px;
}

.nav-btn:hover {
    background-color: rgba(0, 0, 0, 0.8);
    opacity: 1;
    transform: scale(1.1);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
}

.nav-btn:active {
    transform: scale(0.95);
}

/* Setas dos bot√µes */
.nav-arrow {
    font-size: 28px;
    font-weight: bold;
    line-height: 1;
}

/* Bot√£o anterior */
.nav-prev {
    background: linear-gradient(45deg, rgba(0, 0, 0, 0.6), rgba(93, 92, 222, 0.3));
}

.nav-prev:hover {
    background: linear-gradient(45deg, rgba(0, 0, 0, 0.8), rgba(93, 92, 222, 0.5));
}

/* Bot√£o pr√≥ximo */
.nav-next {
    background: linear-gradient(-45deg, rgba(0, 0, 0, 0.6), rgba(93, 92, 222, 0.3));
}

.nav-next:hover {
    background: linear-gradient(-45deg, rgba(0, 0, 0, 0.8), rgba(93, 92, 222, 0.5));
}

/* Estados desabilitados */
.nav-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    pointer-events: auto;
}

.nav-btn:disabled:hover {
    transform: none;
    background-color: rgba(0, 0, 0, 0.6);
    box-shadow: none;
}

/* Anima√ß√£o de pulse quando dispon√≠vel */
.nav-btn.available {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(93, 92, 222, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(93, 92, 222, 0); }
    100% { box-shadow: 0 0 0 0 rgba(93, 92, 222, 0); }
}

/* Responsivo para mobile */
@media (max-width: 768px) {
    .nav-btn {
        width: 50px;
        height: 50px;
        font-size: 20px;
        margin: 0 15px;
    }
    
    .nav-arrow {
        font-size: 24px;
    }
}

@media (max-width: 480px) {
    .nav-btn {
        width: 45px;
        height: 45px;
        font-size: 18px;
        margin: 0 10px;
    }
    
    .nav-arrow {
        font-size: 20px;
    }
    
    .navigation-controls {
        left: 10px;
        right: 10px;
    }
}

/* Efeito fade quando aparecem */
.navigation-controls {
    animation: fadeInNav 0.5s ease-out;
}

@keyframes fadeInNav {
    from {
        opacity: 0;
        transform: translateY(-50%) scale(0.8);
    }
    to {
        opacity: 1;
        transform: translateY(-50%) scale(1);
    }
}
    .overlay-media.video-player {
        width: 98vw;        /* 98% da largura no mobile */
        height: 75vh;       /* 75% da altura no mobile */
        max-width: none;    /* Remove limite de largura */
        max-height: none;   /* Remove limite de altura */
    }
}


        .overlay-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 80px;
            padding: 20px;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
        }

        .overlay-title {
            color:#f5f5f5         
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .overlay-author {
            color:#f5f5f5;          
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .overlay-author img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .overlay-genre {
            display: inline-block;
            padding: 4px 8px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px;
            font-size: 12px;
        }

        .overlay-actions {
            position: absolute;
            right: 20px;
            bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .action-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .action-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .action-btn.liked {
            background-color: var(--heart-color);
        }

        .action-count {
            color:white;
            font-size: 12px;
            margin-top: 4px;
            text-align: center;
        }

        .delete-btn {
            background-color: rgba(239, 68, 68, 0.8);
        }

        /* Comments Panel */
        .comments-panel {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            height: 70vh;
            background-color: var(--surface-color);
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            z-index: 3000;
            transition: bottom 0.3s ease-out;
            display: flex;
            flex-direction: column;
        }

        .comments-panel.active {
            bottom: 0;
        }

        .comments-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .comments-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .comment {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .comment-content {
            flex: 1;
        }

        .comment-author {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .comment-text {
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 4px;
        }

        .comment-time {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .comment-input-container {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .comment-input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 16px;
            outline: none;
            resize: none;
        }

        .send-comment-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .search-container {
                display: none;
            }

            .create-form {
                min-width: auto;
                width: 90vw;
            }

            .feed-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 12px;
            }

            .overlay-info {
                right: 70px;
            }

            .overlay-actions {
                right: 10px;
                gap: 16px;
            }

            .action-btn {
                width: 44px;
                height: 44px;
                font-size: 18px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 0 12px;
            }

            .main-content {
                padding: 12px;
            }

            .feed-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .modal-content {
                padding: 16px;
                margin: 16px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Animations */
        @keyframes heartBeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        .heart-animation {
            animation: heartBeat 0.6s ease-in-out;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 5000;
        }

        .login-content {
            text-align: center;
            max-width: 400px;
            padding: 40px;
        }

        .login-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 16px;
            background: linear-gradient(45deg, var(--primary-color), #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 32px;
        }

        .login-btn {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            background-color: white;
            color: #333;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .login-btn:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }

        .google-icon {
            width: 20px;
            height: 20px;
        }

        /* Alert Custom */
        .custom-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 4000;
            transform: translateX(100%);
            transition: transform 0.3s ease-out;
        }

        .custom-alert.show {
            transform: translateX(0);
        }

        .custom-alert.success {
            background-color: var(--success-color);
        }

        .custom-alert.error {
            background-color: var(--error-color);
        }

        /* Views Modal */
        .views-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .view-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .view-item:last-child {
            border-bottom: none;
        }

        .view-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .view-info {
            flex: 1;
        }

        .view-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .view-time {
            font-size: 12px;
            color: var(--text-secondary);
        }
    
    #heartIcon {
    transition: fill 0.4s ease, stroke 0.4s ease;
    fill: none;
    stroke: white;
  }
  
  #heartIcon.animating {
    fill: red;
    stroke: red;
  }
  
  /* ADICIONE este CSS para mobile: */
@media (max-width: 480px) {
    .delete-toast {
        top: 10px !important;
        right: 10px !important;
        left: 10px !important;
        min-width: auto !important;
    }
}

   
/* ADICIONE estes estilos para o filtro de categorias: */

/* Container do filtro */
.category-filter {
    position: relative;
    margin-right: 16px;
}

/* Bot√£o principal */
.category-button {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    border: 2px solid var(--border-color);
    border-radius: 25px;
    background: linear-gradient(135deg, var(--surface-color), var(--bg-color));
    color: var(--text-color);
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
    font-weight: 500;
    min-width: 140px;
    justify-content: space-between;
}

.category-button:hover {
    border-color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(93, 92, 222, 0.3);
}

.category-button.active {
    background: linear-gradient(135deg, var(--primary-color), #8b5cf6);
    border-color: var(--primary-color);
    color: white;
    box-shadow: 0 4px 15px rgba(93, 92, 222, 0.4);
}

.category-icon {
    font-size: 16px;
}

.category-text {
    flex: 1;
    text-align: left;
}

.category-arrow {
    font-size: 12px;
    transition: transform 0.3s ease;
}

.category-button.active .category-arrow {
    transform: rotate(180deg);
}

/* Dropdown */
.category-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: var(--surface-color);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    margin-top: 8px;
    padding: 8px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    min-width: 220px;
    backdrop-filter: blur(10px);
}

.category-dropdown.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

/* Op√ß√µes do dropdown */
.category-option {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    margin-bottom: 4px;
}

.category-option:last-child {
    margin-bottom: 0;
}

.category-option:hover {
    background-color: var(--bg-color);
    transform: translateX(4px);
}

.category-option.active {
    background: linear-gradient(135deg, var(--primary-color), #8b5cf6);
    color: white;
    transform: translateX(4px);
}

.category-emoji {
    font-size: 18px;
    width: 24px;
    text-align: center;
}

.category-option span:nth-child(2) {
    flex: 1;
    font-weight: 500;
}

.category-count {
    background-color: rgba(255, 255, 255, 0.2);
    color: var(--text-secondary);
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: bold;
    min-width: 20px;
    text-align: center;
}

.category-option.active .category-count {
    background-color: rgba(255, 255, 255, 0.3);
    color: white;
}

/* Responsivo */
@media (max-width: 768px) {
    .category-filter {
        margin-right: 8px;
    }
    
    .category-button {
        min-width: 120px;
        padding: 8px 12px;
        font-size: 13px;
    }
    
    .category-text {
        display: none;
    }
    
    .category-dropdown {
        left: -50px;
        right: -50px;
    }
}

@media (max-width: 480px) {
    .category-dropdown {
        left: -100px;
        right: -100px;
    }
}

/* Anima√ß√µes */
@keyframes categoryPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.category-button.pulse {
    animation: categoryPulse 0.6s ease-in-out;
}
  /* ADICIONE estes estilos ao seu CSS: */

/* Barra de categorias */
.category-bar {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 24px;
    padding: 0 4px;
    flex-wrap: wrap;
}

.category-label {
    font-size: 16px;
    color: var(--text-color);
    font-weight: 600;
    white-space: nowrap;
}

/* Container do filtro principal */
.category-filter-main {
    position: relative;
    flex: 1;
    max-width: 350px;
}

/* Bot√£o de sele√ß√£o */
.category-select {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 18px;
    border: 2px solid var(--border-color);
    border-radius: 16px;
    background: linear-gradient(135deg, var(--surface-color), var(--bg-color));
    color: var(--text-color);
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 15px;
    font-weight: 500;
    justify-content: space-between;
}

.category-select:hover {
    border-color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(93, 92, 222, 0.2);
}

.category-select.active {
    background: linear-gradient(135deg, var(--primary-color), #8b5cf6);
    border-color: var(--primary-color);
    color: white;
    box-shadow: 0 4px 15px rgba(93, 92, 222, 0.3);
}

.category-icon {
    font-size: 18px;
    flex-shrink: 0;
}

.category-text {
    flex: 1;
    text-align: left;
}

.category-arrow {
    font-size: 14px;
    transition: transform 0.3s ease;
    flex-shrink: 0;
}

.category-select.active .category-arrow {
    transform: rotate(180deg);
}

/* Dropdown principal */
.category-dropdown-main {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: var(--surface-color);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    margin-top: 8px;
    padding: 8px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    max-height: 400px;
    overflow-y: auto;
}

.category-dropdown-main.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

/* Op√ß√µes do dropdown */
.category-option {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    margin-bottom: 4px;
}

.category-option:last-child {
    margin-bottom: 0;
}

.category-option:hover {
    background-color: var(--bg-color);
    transform: translateX(4px);
}

.category-option.active {
    background: linear-gradient(135deg, var(--primary-color), #8b5cf6);
    color: white;
    transform: translateX(4px);
}

.category-emoji {
    font-size: 20px;
    width: 28px;
    text-align: center;
    flex-shrink: 0;
}

.category-option span:nth-child(2) {
    flex: 1;
    font-weight: 500;
    font-size: 14px;
}

.category-count {
    background-color: rgba(255, 255, 255, 0.1);
    color: var(--text-secondary);
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
    min-width: 24px;
    text-align: center;
    flex-shrink: 0;
}

.category-option.active .category-count {
    background-color: rgba(255, 255, 255, 0.2);
    color: white;
}

/* Responsivo */
@media (max-width: 768px) {
    .category-bar {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
        margin-bottom: 20px;
    }
    
    .category-label {
        font-size: 15px;
        text-align: center;
    }
    
    .category-filter-main {
        max-width: none;
    }
    
    .category-select {
        padding: 12px 16px;
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .category-bar {
        margin-bottom: 16px;
        padding: 0 2px;
    }
    
    .category-label {
        font-size: 14px;
    }
    
    .category-select {
        padding: 10px 14px;
    }
    
    .category-dropdown-main {
        margin-top: 6px;
        max-height: 300px;
    }
    
    .category-option {
        padding: 10px 14px;
    }
}

/* Anima√ß√µes */
@keyframes categoryPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
}

.category-select.pulse {
    animation: categoryPulse 0.6s ease-in-out;
}

/* Scrollbar customizada para dropdown */
.category-dropdown-main::-webkit-scrollbar {
    width: 6px;
}

.category-dropdown-main::-webkit-scrollbar-track {
    background: var(--bg-color);
    border-radius: 3px;
}

.category-dropdown-main::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 3px;
}

.category-dropdown-main::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}

/* Sa√≠da para cima */
.slide-up {
    animation: slideUpOut 0.25s ease forwards;
}

/* Sa√≠da para baixo */
.slide-down {
    animation: slideDownOut 0.25s ease forwards;
}

/* Entrada de cima */
.slide-up-in {
    animation: slideUpIn 0.25s ease forwards;
}

/* Entrada de baixo */
.slide-down-in {
    animation: slideDownIn 0.25s ease forwards;
}

@keyframes slideUpOut {
    to { transform: translateY(-100%); opacity: 0; }
}

@keyframes slideDownOut {
    to { transform: translateY(100%); opacity: 0; }
}

@keyframes slideUpIn {
    from { transform: translateY(100%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

@keyframes slideDownIn {
    from { transform: translateY(-100%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-content">
            <h1 class="login-title">Reels </h1>
            <p class="login-subtitle">Compartilhe seus momentos favoritos</p>
            <button id="loginBtn" class="login-btn" style="display:none;>
                <svg class="google-icon" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Entrar com Google
            </button>
        </div>
    </div>
    <!-- Main App -->
    <div id="mainApp" style="display: none;">
    	
        <!-- ADICIONE este bot√£o no header, ap√≥s o t√≠tulo: -->

<div class="header">
	
    <h1 class="header-title">Reels</h1>
    

    <!-- BARRA DE PESQUISA MELHORADA -->
    <div class="search-container-advanced">
        <div class="search-wrapper">
               <input type="text" id="searchInput" class="search-input-advanced" 
                   placeholder="Buscar por t√≠tulo, usu√°rio ou g√™nero...">
            <button id="clearSearch" class="clear-search" style="display: none;">‚úï</button>
        </div>
        
        <!-- FILTROS R√ÅPIDOS -->
        <div class="search-filters" id="searchFilters" style="display: none;">
            <div class="filter-section">
                <span class="filter-label">Buscar por:</span>
                <button class="filter-btn active" data-filter="all">Tudo</button>
                <button class="filter-btn" data-filter="title">T√≠tulo</button>
                <button class="filter-btn" data-filter="author">Usu√°rio</button>
                <button class="filter-btn" data-filter="genre">G√™nero</button>
            </div>
        </div>
        
        <!-- RESULTADOS DA BUSCA -->
        <div class="search-results" id="searchResults" style="display: none;">
            <div class="search-stats">
                <span id="searchStats"></span>
            </div>
        </div>
    </div>
            <button id="addBtn" class="add-btn">+</button>
            <div class="user-info" style="display:none;">
                <img id="userAvatar" class="user-avatar" src="" alt="Avatar" style="display:none;">
                <span id="userName"></span>
                <button id="logoutBtn" class="logout-btn" style="display:none;">Sair</button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs-container">
            <button class="tab" data-tab="all" style="display:none;">Todos</button>
            <button class="tab active" data-tab="video">V√≠deos</button>
            <button class="tab" data-tab="image">Imagens</button>
        </div>

        
     <!-- ENCONTRE a div "main-content" e ADICIONE esta barra ANTES do feedContainer: -->

<div class="main-content">
    
    <!-- BARRA DE CATEGORIAS -->
    <div class="category-bar">
        <span class="category-label">Filtrar por categoria:</span>
        
        <div class="category-filter-main">
            <button id="categoryBtn" class="category-select">
                <span class="category-icon">üéØ</span>
                <span class="category-text">Todas as Categorias</span>
                <span class="category-arrow">‚ñº</span>
            </button>
            
            <!-- DROPDOWN DE CATEGORIAS -->
            <div id="categoryDropdown" class="category-dropdown-main">
                <div class="category-option active" data-category="all">
                    <span class="category-emoji">üéØ</span>
                    <span>Todas as Categorias</span>
                    <span class="category-count" id="count-all">0</span>
                </div>
                <div class="category-option" data-category="musica">
                    <span class="category-emoji">üéµ</span>
                    <span>M√∫sica</span>
                    <span class="category-count" id="count-musica">0</span>
                </div>
                <div class="category-option" data-category="comedia">
                    <span class="category-emoji">üòÇ</span>
                    <span>Com√©dia</span>
                    <span class="category-count" id="count-comedia">0</span>
                </div>
                <div class="category-option" data-category="danca">
                    <span class="category-emoji">üíÉ</span>
                    <span>Dan√ßa</span>
                    <span class="category-count" id="count-danca">0</span>
                </div>
                <div class="category-option" data-category="educativo">
                    <span class="category-emoji">üìö</span>
                    <span>Educativo</span>
                    <span class="category-count" id="count-educativo">0</span>
                </div>
                <div class="category-option" data-category="lifestyle">
                    <span class="category-emoji">‚ú®</span>
                    <span>Lifestyle</span>
                    <span class="category-count" id="count-lifestyle">0</span>
                </div>
                <div class="category-option" data-category="outros">
                    <span class="category-emoji">üé≤</span>
                    <span>Outros</span>
                    <span class="category-count" id="count-outros">0</span>
                </div>
            </div>
        </div>
    </div>
    
    <div id="feedContainer">
        <!-- Feed de reels aqui -->
  <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>
  </div>
</div>   
    <!-- Create Modal -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Criar Novo Reel</h2>
                <button class="close-btn">&times;</button>
            </div>
            <form id="createForm" class="create-form">
                <div class="form-group">
                    <label class="form-label">T√≠tulo</label>
                    <input type="text" id="titleInput" class="form-input" placeholder="Digite o t√≠tulo do seu reel" required maxlength="100">
                </div>
                
                <div class="form-group">
                    <label class="form-label">G√™nero</label>
                    <select id="genreSelect" class="form-select" required>
                        <option value="">Selecione um g√™nero</option>
                        <option value="musica">M√∫sica</option>
                        <option value="comedia">Com√©dia</option>
                        <option value="danca">Dan√ßa</option>
                        <option value="educativo">Educativo</option>
                        <option value="lifestyle">Lifestyle</option>
                        <option value="outros">Outros</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Tipo de Conte√∫do</label>
                    <div class="upload-type-tabs">
                        <button type="button" class="upload-tab active" data-type="image">Imagem</button>
                        <button type="button" class="upload-tab" data-type="video">V√≠deo</button>
                    </div>
                </div>

                <div id="imageUpload" class="form-group">
                    <label class="form-label">Upload de Imagem</label>
                    <div class="file-upload" id="fileUploadArea">
                        <div class="upload-icon">üì∑</div>
                        <p>Clique ou arraste uma imagem aqui</p>
                        <input type="file" id="imageInput" accept="image/*" style="display: none;">
                    </div>
                </div>

                <div id="videoUpload" class="form-group" style="display: none;">
                    <label class="form-label">Link do V√≠deo</label>
                    <input type="url" id="videoInput" class="form-input" placeholder="Cole o link do YouTube, Vimeo, etc.">
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    Publicar Reel
                </button>
            </form>
        </div>
    </div>

    <!-- Fullscreen Overlay -->
    <div id="fullscreenOverlay" class="fullscreen-overlay">
        <div class="overlay-header">
            <span id="overlayType" class="overlay-type">V√çDEO</span>
            <button id="overlayClose" class="overlay-close">&times;</button>
        </div>
        <div class="overlay-content">
            <div id="overlayMedia"></div>
        </div>
        <div class="overlay-info">
            <h3 id="overlayTitle" class="overlay-title"></h3>
            <div class="overlay-author">
                <img id="overlayAuthorAvatar" src="" alt="Author">
                <span id="overlayAuthorName"></span>
            </div>
            <span id="overlayGenre" class="overlay-genre"></span>
        </div>
        <div class="overlay-actions">
           <!-- ENCONTRE a se√ß√£o .overlay-actions no seu HTML e ADICIONE os bot√µes de navega√ß√£o: -->

<div class="overlay-actions">
    <button id="deleteBtn" aria-label="Excluir" style="background: none; border: none; cursor: pointer; padding: 0;">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
    <polyline points="3 6 5 6 21 6"></polyline>
    <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"></path>
    <path d="M10 11v6"></path>
    <path d="M14 11v6"></path>
    <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"></path>
  </svg>
</button>

    <div>
        <button id="likeBtn" aria-label="Curtir" style="background: none; border: none; cursor: pointer; padding: 0;">
  <svg id="heartIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
  </svg>
</button>

        <div id="likeCount" class="action-count">0</div>
    </div>
    <div>
       <button id="commentBtn" aria-label="Coment√°rios" style="background: none; border: none; cursor: pointer; padding: 0;">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
  </svg>
</button>

        <div id="commentCount" class="action-count">0</div>
    </div>
    <div>
       <button id="viewBtn" aria-label="Visualiza√ß√µes" style="background: none; border: none; cursor: pointer; padding: 0;">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="3"></circle>
    <path d="M2.458 12C3.732 7.943 7.523 5 12 5s8.268 2.943 9.542 7c-1.274 4.057-5.065 7-9.542 7s-8.268-2.943-9.542-7z"></path>
  </svg>
</button>

        <div id="viewCount" class="action-count">0</div>
    <button id="toggleBtn" aria-label="Toggle Buttons" style="background: none; border: none; cursor: pointer; padding: 0;">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
    <polyline points="6 9 12 15 18 9" />
  </svg>
</button>



</div>
        </div>
    </div>

    <!-- Comments Panel -->
    <div id="commentsPanel" class="comments-panel">
        <div class="comments-header">
            <h3>Coment√°rios</h3>
            <button id="closeComments" class="close-btn">&times;</button>
        </div>
        <div id="commentsList" class="comments-list">
            <!-- Comments will be loaded here -->
        </div>
        <div class="comment-input-container">
            <input type="text" id="commentInput" class="comment-input" placeholder="Adicione um coment√°rio...">
            <button id="sendComment" class="send-comment-btn">‚û§</button>
        </div>
    </div>

    <!-- Views Modal -->
    <div id="viewsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Visualiza√ß√µes</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div id="viewsList" class="views-list">
                <!-- Views will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import { getDatabase, ref, push, set, get, onValue, off, serverTimestamp, remove, update } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";
            

// ADICIONE estas vari√°veis globais no in√≠cio do seu script:

let videoCache = new Map(); // Cache de v√≠deos carregados
let preloadContainer = null; // Container para v√≠deos escondidos

// ADICIONE esta fun√ß√£o para criar o sistema de cache:

function initVideoCache() {
    // Cria container invis√≠vel para preload
    preloadContainer = document.createElement('div');
    preloadContainer.id = 'videoPreloadContainer';
    preloadContainer.style.cssText = `
        position: fixed;
        top: -9999px;
        left: -9999px;
        width: 1px;
        height: 1px;
        overflow: hidden;
        opacity: 0;
        pointer-events: none;
    `;
    document.body.appendChild(preloadContainer);
}

// FUN√á√ÉO para precarregar v√≠deos adjacentes:

function preloadAdjacentVideos(currentStoryId) {
    const filteredStories = getFilteredStories();
    const currentIndex = filteredStories.findIndex(s => s.id === currentStoryId);
    
    // Precarrega anterior e pr√≥ximo
    const toPreload = [
        currentIndex - 1, // Anterior
        currentIndex + 1  // Pr√≥ximo
    ];
    
    toPreload.forEach(index => {
        if (index >= 0 && index < filteredStories.length) {
            const story = filteredStories[index];
            if (story.type === 'video' && !videoCache.has(story.id)) {
                preloadVideo(story);
            }
        }
    });
    
    // Remove v√≠deos muito distantes do cache
    cleanupDistantVideos(currentIndex, filteredStories);
}

// SUBSTITUA a fun√ß√£o preloadVideo por esta vers√£o sem autoplay:

function preloadVideo(story) {
    if (videoCache.has(story.id)) return;
    
    const iframe = document.createElement('iframe');
    
    // URL SEM AUTOPLAY para preload
    let preloadUrl = getEmbedUrl(story.url);
    preloadUrl = preloadUrl.replace('autoplay=1', 'autoplay=0');
    
    iframe.src = preloadUrl;
    iframe.className = 'overlay-media video-player';
    iframe.width = '100%';
    iframe.height = '100%';
    iframe.frameBorder = '0';
    iframe.allowFullscreen = true;
    iframe.id = `preload-${story.id}`;
    
    // Adiciona ao container invis√≠vel
    preloadContainer.appendChild(iframe);
    
    // Salva no cache
    videoCache.set(story.id, {
        iframe: iframe,
        story: story,
        loadTime: Date.now()
    });
    
    console.log(`üìπ V√≠deo precarregado (sem autoplay): ${story.title}`);
}

// FUN√á√ÉO para usar v√≠deo do cache:

function getVideoFromCache(storyId) {
    if (videoCache.has(storyId)) {
        const cached = videoCache.get(storyId);
        
        // Remove do container de preload
        if (cached.iframe.parentNode === preloadContainer) {
            preloadContainer.removeChild(cached.iframe);
        }
        
        return cached.iframe;
    }
    return null;
}

// FUN√á√ÉO para limpar v√≠deos distantes:

function cleanupDistantVideos(currentIndex, filteredStories) {
    const keepDistance = 2; // Mant√©m 2 v√≠deos de dist√¢ncia
    
    videoCache.forEach((cached, storyId) => {
        const storyIndex = filteredStories.findIndex(s => s.id === storyId);
        const distance = Math.abs(storyIndex - currentIndex);
        
        // Remove se estiver muito distante
        if (distance > keepDistance) {
            if (cached.iframe.parentNode) {
                cached.iframe.parentNode.removeChild(cached.iframe);
            }
            videoCache.delete(storyId);
            console.log(`üóëÔ∏è V√≠deo removido do cache: ${cached.story.title}`);
        }
    });
}
// ADICIONE esta fun√ß√£o para parar TODOS os v√≠deos:

function stopAllVideos() {
    // Para v√≠deo atual
    function stopCurrentVideo() {
    // Para v√≠deo atual
    const currentVideo = document.getElementById('currentVideo');
    if (currentVideo) {
        currentVideo.src = 'about:blank';
        currentVideo.remove();
    }
    
    // Para todos os outros tamb√©m
    stopAllVideos();
}
    
    // Para todos os v√≠deos no cache
    videoCache.forEach((cached, storyId) => {
        if (cached.iframe && cached.iframe.src !== 'about:blank') {
            cached.iframe.src = 'about:blank';
            // Recria com src original para pr√≥xima vez
            setTimeout(() => {
                if (cached.iframe.parentNode === preloadContainer) {
                    cached.iframe.src = getEmbedUrl(cached.story.url);
                }
            }, 100);
        }
    });
    
    // ADICIONE esta fun√ß√£o para garantir que s√≥ um v√≠deo toca:

function ensureOnlyCurrentVideoPlays() {
    const currentVideo = document.getElementById('currentVideo');
    
    // Para todos os outros v√≠deos
    document.querySelectorAll('iframe').forEach(iframe => {
        if (iframe !== currentVideo && 
            (iframe.src.includes('youtube.com') || iframe.src.includes('vimeo.com')) &&
            iframe.src !== 'about:blank') {
            
            // Para v√≠deos que n√£o s√£o o atual
            const originalSrc = iframe.src;
            iframe.src = 'about:blank';
            
            // Se for preload, restaura SEM autoplay
            if (iframe.parentNode === preloadContainer) {
                setTimeout(() => {
                    iframe.src = originalSrc.replace('autoplay=1', 'autoplay=0');
                }, 200);
            }
        }
    });
}
}
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCE_vGty5XsV1YqdCi49Ck2xJDSFq284wc",
            authDomain: "cliente-movicel.firebaseapp.com",
            databaseURL: "https://cliente-movicel-default-rtdb.firebaseio.com",
            projectId: "cliente-movicel",
            storageBucket: "cliente-movicel.firebasestorage.app",
            messagingSenderId: "215414688375",
            appId: "1:215414688375:web:2c7d20a0c03c4c0fcfd472",
            measurementId: "G-7F1RGP9GHV"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const provider = new GoogleAuthProvider();

        // ImgBB API Key
        const apiKeyImgBB = 'e073e02267a1f0259cd69c562e780659';

        // Global variables
        let currentUser = null;
        let allStories = [];
        let currentFilter = 'all';
        let currentStoryId = null;
        let currentStoryIndex = 0;
        let searchQuery = '';

        // DOM Elements
        const loginScreen = document.getElementById('loginScreen');
        const mainApp = document.getElementById('mainApp');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const feedContainer = document.getElementById('feedContainer');
        const addBtn = document.getElementById('addBtn');
        const createModal = document.getElementById('createModal');
        const createForm = document.getElementById('createForm');
        const searchInput = document.getElementById('searchInput');
        const fullscreenOverlay = document.getElementById('fullscreenOverlay');
        const commentsPanel = document.getElementById('commentsPanel');
        const viewsModal = document.getElementById('viewsModal');

        // Auth state listener
        // ADICIONE no in√≠cio da fun√ß√£o onAuthStateChanged, logo ap√≥s definir currentUser:

onAuthStateChanged(auth, (user) => {
    if (user) {
        currentUser = {
            uid: user.uid,
            name: user.displayName || 'Usu√°rio An√¥nimo',
            avatar: user.photoURL || 'https://via.placeholder.com/40',
            email: user.email || ''
        };
        
        // Update UI
        userAvatar.src = currentUser.avatar;
        userName.textContent = currentUser.name;
        
        // INICIALIZA SISTEMA DE CACHE
        initVideoCache();
        
        // Show main app
        loginScreen.style.display = 'none';
        mainApp.style.display = 'block';
        
        // Load stories
        loadStories();
    } else {
        // Show login screen
        loginScreen.style.display = 'flex';
        mainApp.style.display = 'none';
        currentUser = null;
    }
});

        // Login with Google
        loginBtn.addEventListener('click', async () => {
            try {
                await signInWithPopup(auth, provider);
                showAlert('Login realizado com sucesso!', 'success');
            } catch (error) {
                console.error('Login error:', error);
                // Fallback to anonymous login
                try {
                    await signInAnonymously(auth);
                    showAlert('Entrando como usu√°rio an√¥nimo...', 'success');
                } catch (anonError) {
                    showAlert('Erro ao fazer login. Tente novamente.', 'error');
                }
            }
        });

        // Logout
        logoutBtn.addEventListener('click', async () => {
            if (await showConfirm('Tem certeza que deseja sair?')) {
                try {
                    await signOut(auth);
                    showAlert('Logout realizado com sucesso!', 'success');
                } catch (error) {
                    showAlert('Erro ao fazer logout.', 'error');
                }
            }
        });

     
        // Tab switching
      document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentFilter = tab.dataset.tab;
        filterAndRenderStories();
    });
});


        // Search
        searchInput.addEventListener('input', (e) => {
            searchQuery = e.target.value.toLowerCase();
            filterAndRenderStories();
        });

        // Add button
        addBtn.addEventListener('click', () => {
            openCreateModal();
        });

        // Load stories from Firebase
        function loadStories() {
            const storiesRef = ref(database, 'stories');
            onValue(storiesRef, (snapshot) => {
                allStories = [];
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    Object.keys(data).forEach(key => {
                        allStories.push({
                            id: key,
                            ...data[key]
                        });
                    });
                    // Sort by timestamp (newest first)
                    allStories.sort((a, b) => b.timestamp - a.timestamp);
                }
                filterAndRenderStories();
                
            });
        }

        // Filter and render stories
        function filterAndRenderStories() {
            let filteredStories = allStories;

            // Filter by type
            if (currentFilter !== 'all') {
                filteredStories = filteredStories.filter(story => story.type === currentFilter);
            }
                        

            // Filter by search query
            if (searchQuery) {
                filteredStories = filteredStories.filter(story => 
                    story.title.toLowerCase().includes(searchQuery) ||
                    story.author.toLowerCase().includes(searchQuery) ||
                    story.genre.toLowerCase().includes(searchQuery)
                );
            }

       // ORDENA POR MAIS REAGIDOS (sempre)
    filteredStories.sort((a, b) => {
        const aTotal = (a.stats?.views || 0) + (a.stats?.likes || 0) + (a.stats?.comments || 0);
        const bTotal = (b.stats?.views || 0) + (b.stats?.likes || 0) + (b.stats?.comments || 0);
        return bTotal - aTotal;
    });     renderStories(filteredStories);
        }

        // Render stories in grid
        function renderStories(stories) {
            if (stories.length === 0) {
                feedContainer.innerHTML = `
                    <div class="empty-state">
                        <h3>Nenhum reel encontrado</h3>
                        <p>Seja o primeiro a compartilhar algo incr√≠vel!</p>
                    </div>
                `;
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'feed-grid';

            stories.forEach((story, index) => {
                const card = createStoryCard(story, index);
                grid.appendChild(card);
            });

            feedContainer.innerHTML = '';
            feedContainer.appendChild(grid);
        }

        // Create story card
        function createStoryCard(story, index) {
            const card = document.createElement('div');
            card.className = 'reel-card';
            card.addEventListener('click', () => openFullscreen(story.id));

            const stats = story.stats || { likes: 0, comments: 0, views: 0 };
            
            let thumbnailContent = '';
            if (story.type === 'image') {
                thumbnailContent = `<img src="${story.url}" alt="${story.title}">`;
            } else {
                thumbnailContent = `
                    <img src="https://img.youtube.com/vi/${getYouTubeVideoId(story.url)}/maxresdefault.jpg" alt="${story.title}">
                    <div class="play-icon">‚ñ∂</div>
                `;
            }

            card.innerHTML = `
                <div class="reel-thumbnail">
                    ${thumbnailContent}
                    <div class="type-badge ${story.type}">${story.type === 'video' ? 'V√çDEO' : 'IMAGEM'}</div>
                </div>
                <div class="reel-info">
                    <h3 class="reel-title">${story.title}</h3>
                    <div class="reel-author">
                        <img src="${story.authorAvatar}" alt="${story.author}">
                        <span class="reel-author-name">${story.author}</span>
                    </div>
                    <div class="reel-genre">#${story.genre}</div>
                    <div class="reel-stats">
                        <div class="stat">
                            <span>‚ù§Ô∏è</span>
                            <span>${stats.likes}</span>
                        </div>
                        <div class="stat">
                            <span>üí¨</span>
                            <span>${stats.comments}</span>
                        </div>
                        <div class="stat">
                            <span>üëÅÔ∏è</span>
                            <span>${stats.views}</span>
                        </div>
                    </div>
                </div>
            `;

            return card;
        }

        // Open fullscreen view
        function openFullscreen(storyId) {
            currentStoryId = storyId;
            const story = allStories.find(s => s.id === storyId);
            if (!story) return;

            currentStoryIndex = allStories.indexOf(story);

            // Update overlay content
            document.getElementById('overlayType').textContent = story.type.toUpperCase();
            document.getElementById('overlayTitle').textContent = story.title;
            document.getElementById('overlayAuthorAvatar').src = story.authorAvatar;
            document.getElementById('overlayAuthorName').textContent = story.author;
            document.getElementById('overlayGenre').textContent = `#${story.genre}`;

            // Show/hide delete button
            const deleteBtn = document.getElementById('deleteBtn');
            if (currentUser && currentUser.uid === story.authorId) {
                deleteBtn.style.display = 'block';
            } else {
                deleteBtn.style.display = 'none';
            }

        // SUBSTITUA a parte de carregamento de m√≠dia na fun√ß√£o openFullscreen():

// Load media
const overlayMedia = document.getElementById('overlayMedia');

// PARA TODOS OS V√çDEOS PRIMEIRO
stopAllVideos();

// IMPORTANTE: Limpa conte√∫do anterior
overlayMedia.innerHTML = '';

if (story.type === 'image') {
    const img = document.createElement('img');
    img.src = story.url;
    img.className = 'overlay-media';
    img.alt = story.title;
    overlayMedia.appendChild(img);
} else {
    // VERIFICA SE J√Å EST√Å NO CACHE
    const cachedVideo = getVideoFromCache(story.id);
    
    if (cachedVideo) {
        // PARA o v√≠deo do cache antes de mover
        cachedVideo.src = 'about:blank';
        
        // USA V√çDEO DO CACHE com nova URL (autoplay)
        cachedVideo.src = getEmbedUrl(story.url);
        cachedVideo.id = 'currentVideo';
        overlayMedia.appendChild(cachedVideo);
        
        console.log(`‚ö° V√≠deo carregado do cache: ${story.title}`);
    } else {
        // CRIA NOVO V√çDEO
        const iframe = document.createElement('iframe');
        iframe.src = getEmbedUrl(story.url);
        iframe.className = 'overlay-media video-player';
        iframe.width = '100%';
        iframe.height = '100%';
        iframe.frameBorder = '0';
        iframe.allowFullscreen = true;
        iframe.id = 'currentVideo';
        
        // FOR√áA AUTOPLAY quando carregar
        iframe.onload = function() {
            console.log(`üéµ Autoplay ativado: ${story.title}`);
        };
        
        overlayMedia.appendChild(iframe);
        console.log(`üîÑ V√≠deo carregando: ${story.title}`);
    }
    
    // GARANTE que apenas este v√≠deo toca
    setTimeout(() => {
        ensureOnlyCurrentVideoPlays();
    }, 500);
}

// PRECARREGA v√≠deos adjacentes (SEM autoplay)
if (story.type === 'video') {
    setTimeout(() => {
        preloadAdjacentVideos(story.id);
    }, 1000);
}

            // Record view
            recordView(storyId);

            // Load interactions
            loadInteractions(storyId);

            // Show overlay
            fullscreenOverlay.style.display = 'flex';

            // Add swipe/keyboard navigation
            setupNavigation();
        }

        // Record view
        function recordView(storyId) {
            if (!currentUser) return;

            const viewRef = ref(database, `stories/${storyId}/views/${currentUser.uid}`);
            set(viewRef, {
                user: currentUser.name,
                timestamp: Date.now()
            });

            // Update stats
            updateStats(storyId);
        }

        // Load interactions (likes, comments, views)
        function loadInteractions(storyId) {
            // Load likes
            const likesRef = ref(database, `stories/${storyId}/likes`);
            onValue(likesRef, (snapshot) => {
                const likes = snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
                document.getElementById('likeCount').textContent = likes;
                
                // Update like button state
                const likeBtn = document.getElementById('likeBtn');
                if (currentUser && snapshot.exists() && snapshot.val()[currentUser.uid]) {
                    likeBtn.classList.add('liked');
                } else {
                    likeBtn.classList.remove('liked');
                }
            });

            // Load comments
            const commentsRef = ref(database, `stories/${storyId}/comments`);
            onValue(commentsRef, (snapshot) => {
                const comments = snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
                document.getElementById('commentCount').textContent = comments;
            });

            // Load views
            const viewsRef = ref(database, `stories/${storyId}/views`);
            onValue(viewsRef, (snapshot) => {
                const views = snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
                document.getElementById('viewCount').textContent = views;
            });
        }

        // Update stats in database
        function updateStats(storyId) {
            const story = allStories.find(s => s.id === storyId);
            if (!story) return;

            const likesRef = ref(database, `stories/${storyId}/likes`);
            const commentsRef = ref(database, `stories/${storyId}/comments`);
            const viewsRef = ref(database, `stories/${storyId}/views`);

            Promise.all([
                get(likesRef),
                get(commentsRef),
                get(viewsRef)
            ]).then(([likesSnap, commentsSnap, viewsSnap]) => {
                const stats = {
                    likes: likesSnap.exists() ? Object.keys(likesSnap.val()).length : 0,
                    comments: commentsSnap.exists() ? Object.keys(commentsSnap.val()).length : 0,
                    views: viewsSnap.exists() ? Object.keys(viewsSnap.val()).length : 0
                };

                const statsRef = ref(database, `stories/${storyId}/stats`);
                set(statsRef, stats);
            });
        }

	    // Setup navigation for fullscreen
        function setupNavigation() {
    let startY = 0;
    let isTouch = false;
    const SWIPE_THRESHOLD = 40;

    const handleKeydown = (e) => {
        if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
            navigateStoryDirect(-1);
        } else if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
            navigateStoryDirect(1);
        } else if (e.key === 'Escape') {
            closeFullscreen();
        }
    };

    const handleTouchStart = (e) => {
        if (!('ontouchstart' in window)) return;
        if (e.target.closest('.overlay-close, .action-btn, button')) return;
        startY = e.touches[0].clientY;
        isTouch = true;
    };

    const handleTouchEnd = (e) => {
        if (!isTouch) return;
        const diffY = e.changedTouches[0].clientY - startY;
        if (Math.abs(diffY) > SWIPE_THRESHOLD) {
            navigateStoryDirect(diffY > 0 ? -1 : 1);
        }
        isTouch = false;
    };

    document.addEventListener('keydown', handleKeydown);
    fullscreenOverlay.addEventListener('touchstart', handleTouchStart, { passive: true });
    fullscreenOverlay.addEventListener('touchend', handleTouchEnd, { passive: true });

    fullscreenOverlay.cleanup = () => {
        document.removeEventListener('keydown', handleKeydown);
        fullscreenOverlay.removeEventListener('touchstart', handleTouchStart);
        fullscreenOverlay.removeEventListener('touchend', handleTouchEnd);
    };
}

function preloadMedia(story, callback) {
    if (story.type === 'image') {
        const img = new Image();
        img.src = story.src;
        img.onload = callback;
        img.onerror = callback; // mesmo se falhar, n√£o travar
    } else if (story.type === 'video') {
        if (videoCache.has(story.id)) {
            callback();
        } else {
            const vid = document.createElement('video');
            vid.src = story.src;
            vid.preload = 'auto';
            vid.oncanplaythrough = callback;
            vid.onerror = callback;
        }
    } else {
        callback();
    }
}

function navigateStoryDirect(direction) {
    const filteredStories = getFilteredStories();
    const currentIndex = filteredStories.findIndex(s => s.id === currentStoryId);
    const newIndex = currentIndex + direction;

    if (newIndex >= 0 && newIndex < filteredStories.length) {
        const nextStory = filteredStories[newIndex];
        const overlayContent = document.querySelector('.overlay-content');

        stopAllVideos();

        // Adiciona classe de sa√≠da
        overlayContent.classList.add(direction > 0 ? 'slide-up' : 'slide-down');

        // Pr√©-carrega antes de trocar
        preloadMedia(nextStory, () => {
            overlayContent.addEventListener('animationend', function handler() {
                overlayContent.removeEventListener('animationend', handler);

                openFullscreen(nextStory.id);

                overlayContent.classList.remove('slide-up', 'slide-down');
                overlayContent.classList.add(direction > 0 ? 'slide-up-in' : 'slide-down-in');

                overlayContent.addEventListener('animationend', function endHandler() {
                    overlayContent.removeEventListener('animationend', endHandler);
                    overlayContent.classList.remove('slide-up-in', 'slide-down-in');
                });
            });
        });
    }
}
// REMOVA as fun√ß√µes navigateStorySimple() antigas se existirem

        // Navigate between stories
        function navigateStory(direction) {
            const filteredStories = getFilteredStories();
            const currentIndex = filteredStories.findIndex(s => s.id === currentStoryId);
            const newIndex = currentIndex + direction;

            if (newIndex >= 0 && newIndex < filteredStories.length) {
                openFullscreen(filteredStories[newIndex].id);
            }
        }

        // Get filtered stories
        function getFilteredStories() {
            let filtered = allStories;
            if (currentFilter !== 'all') {
                filtered = filtered.filter(story => story.type === currentFilter);
            }
            if (searchQuery) {
                filtered = filtered.filter(story => 
                    story.title.toLowerCase().includes(searchQuery) ||
                    story.author.toLowerCase().includes(searchQuery) ||
                    story.genre.toLowerCase().includes(searchQuery)
                );
            }
            return filtered;
        }
	
	        // Close fullscreen
	        // SUBSTITUA a fun√ß√£o 	closeFullscreen() existente por esta 	vers√£o:
	
	function closeFullscreen() {
	    // PARA O V√çDEO antes de fechar
	    const overlayMedia = document.	getElementById('overlayMedia');
	    
	    // Limpa completamente o 	conte√∫do (para o v√≠deo)
	    overlayMedia.innerHTML = '';
	    
	    // Esconde o overlay
	    fullscreenOverlay.style.display 	= 'none';
	    
	    // Limpa listeners
	    if (fullscreenOverlay.cleanup) {
	        fullscreenOverlay.cleanup();
	    }
	    
	    // Limpa listeners do Firebase
	    if (currentStoryId) {
	        const storyRef = 	ref(database, `stories/	${currentStoryId}`);
	        off(storyRef);
	    }
	    
	    // Reset de vari√°veis
	    currentStoryId = null;
	}
	
	        // Action button event 	listeners
	        document.	getElementById('overlayClose').	addEventListener('click', 	closeFullscreen);
	
	        document.	getElementById('likeBtn').	addEventListener('click', () => {
	            	toggleLike(currentStoryId);
	        });
	
	        document.	getElementById('commentBtn').	addEventListener('click', () => {
	            	openComments(currentStoryId);
	        });
	
	        document.	getElementById('viewBtn').	addEventListener('click', () => {
            openViews(currentStoryId);
        });

        document.getElementById('deleteBtn').addEventListener('click', async () => {
            if (await showConfirm('Tem certeza que deseja deletar este reel?')) {
                deleteStory(currentStoryId);
            }
        });

        // Toggle like
        function toggleLike(storyId) {
            if (!currentUser) return;

            const likeRef = ref(database, `stories/${storyId}/likes/${currentUser.uid}`);
            
            get(likeRef).then((snapshot) => {
                if (snapshot.exists()) {
                    // Unlike
                    remove(likeRef);
                } else {
                    // Like
                    set(likeRef, {
                        user: currentUser.name,
                        timestamp: Date.now()
                    });
                    
                    // Heart animation
                    const likeBtn = document.getElementById('likeBtn');
                    likeBtn.classList.add('heart-animation');
                    setTimeout(() => {
                        likeBtn.classList.remove('heart-animation');
                    }, 600);
                }
                
                updateStats(storyId);
            });
        }

        // Open comments panel
        function openComments(storyId) {
            currentStoryId = storyId;
            loadComments(storyId);
            commentsPanel.classList.add('active');
        }

        // Load comments
        function loadComments(storyId) {
            const commentsRef = ref(database, `stories/${storyId}/comments`);
            onValue(commentsRef, (snapshot) => {
                const commentsList = document.getElementById('commentsList');
                commentsList.innerHTML = '';

                if (snapshot.exists()) {
                    const comments = [];
                    snapshot.forEach((childSnapshot) => {
                        comments.push({
                            id: childSnapshot.key,
                            ...childSnapshot.val()
                        });
                    });

                    // Sort by timestamp
                    comments.sort((a, b) => a.timestamp - b.timestamp);

                    comments.forEach(comment => {
                        const commentEl = createCommentElement(comment);
                        commentsList.appendChild(commentEl);
                    });

                    // Scroll to bottom
                    commentsList.scrollTop = commentsList.scrollHeight;
                } else {
                    commentsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Nenhum coment√°rio ainda. Seja o primeiro!</p>';
                }
            });
        }

        // Create comment element
        function createCommentElement(comment) {
            const div = document.createElement('div');
            div.className = 'comment';

            const timeAgo = getTimeAgo(comment.timestamp);

            div.innerHTML = `
                <img src="${comment.authorAvatar}" alt="${comment.author}" class="comment-avatar">
                <div class="comment-content">
                    <div class="comment-author">${comment.author}</div>
                    <div class="comment-text">${comment.text}</div>
                    <div class="comment-time">${timeAgo}</div>
                </div>
            `;

            return div;
        }

        // Comments panel event listeners
        document.getElementById('closeComments').addEventListener('click', () => {
            commentsPanel.classList.remove('active');
        });

        document.getElementById('sendComment').addEventListener('click', () => {
            addComment(currentStoryId);
        });

        document.getElementById('commentInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addComment(currentStoryId);
            }
        });

        // Add comment
        function addComment(storyId) {
            if (!currentUser) return;

            const commentInput = document.getElementById('commentInput');
            const text = commentInput.value.trim();

            if (!text) return;

            const commentsRef = ref(database, `stories/${storyId}/comments`);
            const newCommentRef = push(commentsRef);

            set(newCommentRef, {
                text: text,
                author: currentUser.name,
                authorId: currentUser.uid,
                authorAvatar: currentUser.avatar,
                timestamp: Date.now()
            }).then(() => {
                commentInput.value = '';
                updateStats(storyId);
            });
        }

        // Open views modal
        function openViews(storyId) {
            const viewsRef = ref(database, `stories/${storyId}/views`);
            get(viewsRef).then((snapshot) => {
                const viewsList = document.getElementById('viewsList');
                viewsList.innerHTML = '';

                if (snapshot.exists()) {
                    const views = [];
                    snapshot.forEach((childSnapshot) => {
                        views.push({
                            userId: childSnapshot.key,
                            ...childSnapshot.val()
                        });
                    });

                    // Sort by timestamp (newest first)
                    views.sort((a, b) => b.timestamp - a.timestamp);

                    views.forEach(view => {
                        const viewEl = createViewElement(view);
                        viewsList.appendChild(viewEl);
                    });
                } else {
                    viewsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Nenhuma visualiza√ß√£o ainda.</p>';
                }

                viewsModal.classList.add('active');
            });
        }

        // Create view element
        function createViewElement(view) {
            const div = document.createElement('div');
            div.className = 'view-item';

            const timeAgo = getTimeAgo(view.timestamp);

            div.innerHTML = `
                <img src="https://via.placeholder.com/40" alt="${view.user}" class="view-avatar">
                <div class="view-info">
                    <div class="view-name">${view.user}</div>
                    <div class="view-time">${timeAgo}</div>
                </div>
            `;

            return div;
        }

        // FUN√á√ÉO DE DELETAR DIRETO
window.deleteStory = function(storyId) {
    console.log('üóëÔ∏è Deletando diretamente:', storyId);
    
    const dbRef = ref(database, `stories/${storyId}`);
    
    remove(dbRef).then(() => {
        console.log('‚úÖ Removido do Firebase');
        
        // Remove da lista local
        allStories = allStories.filter(s => s.id !== storyId);
        
        // Fecha overlay
        fullscreenOverlay.style.display = 'none';
        
        // Atualiza tela
        filterAndRenderStories();
        
        showAlert('Reel deletado!', 'success');
        
    }).catch(error => {
        console.log('‚ùå Erro:', error);
        showAlert('Erro ao deletar', 'error');
    });
};

// LISTENER DIRETO - SEM CONFIRMA√á√ÉO
document.getElementById('deleteBtn').onclick = function(e) {
    e.preventDefault();
    e.stopPropagation();
    
    console.log('Delete clicado - deletando diretamente!');
    
    if (!currentStoryId) {
        showAlert('Erro: Nenhum v√≠deo selecionado', 'error');
        return;
    }
    
    // DELETA DIRETO - SEM PERGUNTAR
    deleteStory(currentStoryId);
};

console.log('‚úÖ Exclus√£o direta ativada!');

        // Create modal functionality
        function openCreateModal() {
            if (!currentUser) {
                showAlert('Voc√™ precisa estar logado para criar reels.', 'error');
                return;
            }
            createModal.classList.add('active');
        }

        // Upload type tabs
        document.querySelectorAll('.upload-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.upload-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                const type = tab.dataset.type;
                const imageUpload = document.getElementById('imageUpload');
                const videoUpload = document.getElementById('videoUpload');

                if (type === 'image') {
                    imageUpload.style.display = 'block';
                    videoUpload.style.display = 'none';
                } else {
                    imageUpload.style.display = 'none';
                    videoUpload.style.display = 'block';
                }
            });
        });

        // File upload area
        const fileUploadArea = document.getElementById('fileUploadArea');
        const imageInput = document.getElementById('imageInput');

        fileUploadArea.addEventListener('click', () => {
            imageInput.click();
        });

        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('dragover');
        });

        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.classList.remove('dragover');
        });

        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                imageInput.files = files;
                handleImageUpload(files[0]);
            }
        });

        imageInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleImageUpload(e.target.files[0]);
            }
        });

        // Handle image upload
        function handleImageUpload(file) {
            if (!file.type.startsWith('image/')) {
                showAlert('Por favor, selecione um arquivo de imagem v√°lido.', 'error');
                return;
            }

            const maxSize = 10 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                showAlert('O arquivo √© muito grande. M√°ximo 10MB.', 'error');
                return;
            }

            // Preview
            const reader = new FileReader();
            reader.onload = (e) => {
                fileUploadArea.innerHTML = `
                    <img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                    <p>Imagem selecionada</p>
                `;
            };
            reader.readAsDataURL(file);
        }

        // Create form submission
        createForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentUser) return;

            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Publicando...';
            submitBtn.disabled = true;

            try {
                const title = document.getElementById('titleInput').value.trim();
                const genre = document.getElementById('genreSelect').value;
                const activeTab = document.querySelector('.upload-tab.active').dataset.type;

                let url = '';
                let type = activeTab;

                if (type === 'image') {
                    const file = imageInput.files[0];
                    if (!file) {
                        throw new Error('Selecione uma imagem');
                    }
                    url = await uploadImageToImgBB(file);
                } else {
                    url = document.getElementById('videoInput').value.trim();
                    if (!url) {
                        throw new Error('Digite o link do v√≠deo');
                    }
                    if (!isValidVideoUrl(url)) {
                        throw new Error('Link de v√≠deo inv√°lido');
                    }
                }

                // Create story object
                const storyData = {
                    title,
                    genre,
                    type,
                    url,
                    author: currentUser.name,
                    authorId: currentUser.uid,
                    authorAvatar: currentUser.avatar,
                    timestamp: serverTimestamp(),
                    stats: {
                        likes: 0,
                        comments: 0,
                        views: 0
                    }
                };

                // Save to Firebase
                const storiesRef = ref(database, 'stories');
                const newStoryRef = push(storiesRef);
                await set(newStoryRef, storyData);

                showAlert('Reel publicado com sucesso!', 'success');
                createModal.classList.remove('active');
                createForm.reset();
                
                // Reset upload area
                fileUploadArea.innerHTML = `
                    <div class="upload-icon">üì∑</div>
                    <p>Clique ou arraste uma imagem aqui</p>
                `;

            } catch (error) {
                showAlert(error.message, 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        // Upload image to ImgBB
        async function uploadImageToImgBB(file) {
            const formData = new FormData();
            formData.append('image', file);

            const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKeyImgBB}`, {
                method: 'POST',
                body: formData
            });

            const data = await response.json();
            
            if (!data.success) {
                throw new Error('Erro ao fazer upload da imagem');
            }

            return data.data.url;
        }

        // Validate video URL
        function isValidVideoUrl(url) {
            const videoPatterns = [
                /youtube\.com\/watch\?v=([a-zA-Z0-9_-]+)/,
                /youtu\.be\/([a-zA-Z0-9_-]+)/,
                /vimeo\.com\/(\d+)/,
                /dailymotion\.com\/video\/([a-zA-Z0-9]+)/,
              
            ];
            
            return videoPatterns.some(pattern => pattern.test(url));
        }

        // Get YouTube video ID
        function getYouTubeVideoId(url) {
            const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);
            return match ? match[1] : '';
        }

        // Get embed URL
        // SUBSTITUA a fun√ß√£o getEmbedUrl por esta vers√£o melhorada:

// FOR√áA todos os v√≠deos a N√ÉO reproduzir automaticamente
window.getEmbedUrl = function(url) {
    if (url.includes('youtube.com') || url.includes('youtu.be')) {
        const videoId = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/)[1];
        return `https://www.youtube.com/embed/${videoId}?autoplay=0&controls=1`;
    } else if (url.includes('vimeo.com')) {
        const videoId = url.match(/vimeo\.com\/(\d+)/)[1];
        return `https://player.vimeo.com/video/${videoId}?autoplay=0&controls=1`;
    }
    return url;
};
        // Modal close functionality
        document.querySelectorAll('.close-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const modal = e.target.closest('.modal');
                if (modal) {
                    modal.classList.remove('active');
                }
            });
        });

        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // Utility functions
        function getTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            
            const minutes = Math.floor(diff / (1000 * 60));
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            if (minutes < 1) return 'agora';
            if (minutes < 60) return `${minutes}m`;
            if (hours < 24) return `${hours}h`;
            return `${days}d`;
        }

        function showAlert(message, type = 'success') {
            const alert = document.createElement('div');
            alert.className = `custom-alert ${type}`;
            alert.textContent = message;
            document.body.appendChild(alert);

            setTimeout(() => {
                alert.classList.add('show');
            }, 100);

            setTimeout(() => {
                alert.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(alert);
                }, 300);
            }, 3000);
        }

        function showConfirm(message) {
            return new Promise((resolve) => {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 400px;">
                        <div class="modal-header">
                            <h2 class="modal-title">Confirma√ß√£o</h2>
                        </div>
                        <p style="margin-bottom: 20px; color: var(--text-color);">${message}</p>
                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button class="submit-btn" style="background-color: var(--border-color);" onclick="resolve(false)">Cancelar</button>
                            <button class="submit-btn" onclick="resolve(true)">Confirmar</button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Add event listeners to buttons
                const buttons = modal.querySelectorAll('button');
                buttons[0].addEventListener('click', () => {
                    document.body.removeChild(modal);
                    resolve(false);
                });
                buttons[1].addEventListener('click', () => {
                    document.body.removeChild(modal);
                    resolve(true);
                });

                // Close on background click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                        resolve(false);
                    }
                });
            });
        }

        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
        
        // 
    
    // ADICIONE estas vari√°veis globais:
let selectedCategory = 'all';
let categoryDropdownOpen = false;

// ELEMENTOS
const categoryBtn = document.getElementById('categoryBtn');
const categoryDropdown = document.getElementById('categoryDropdown');
const categoryText = categoryBtn.querySelector('.category-text');
const categoryIcon = categoryBtn.querySelector('.category-icon');

// MAPEAMENTO DE CATEGORIAS
const categoryMap = {
    all: { emoji: 'üéØ', name: 'Todas' },
    musica: { emoji: 'üéµ', name: 'M√∫sica' },
    comedia: { emoji: 'üòÇ', name: 'Com√©dia' },
    danca: { emoji: 'üíÉ', name: 'Dan√ßa' },
    educativo: { emoji: 'üìö', name: 'Educativo' },
    lifestyle: { emoji: '‚ú®', name: 'Lifestyle' },
    outros: { emoji: 'üé≤', name: 'Outros' }
};

// TOGGLE DROPDOWN
categoryBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleCategoryDropdown();
});

function toggleCategoryDropdown() {
    categoryDropdownOpen = !categoryDropdownOpen;
    
    if (categoryDropdownOpen) {
        updateCategoryCounts();
        categoryDropdown.classList.add('show');
        categoryBtn.classList.add('active');
    } else {
        categoryDropdown.classList.remove('show');
        categoryBtn.classList.remove('active');
    }
}

// FECHAR DROPDOWN CLICANDO FORA
document.addEventListener('click', (e) => {
    if (!e.target.closest('.category-filter') && categoryDropdownOpen) {
        toggleCategoryDropdown();
    }
});

// SELECIONAR CATEGORIA
document.querySelectorAll('.category-option').forEach(option => {
    option.addEventListener('click', (e) => {
        e.stopPropagation();
        selectCategory(option.dataset.category);
    });
});

function selectCategory(category) {
    selectedCategory = category;
    
    // Atualiza bot√£o
    const categoryInfo = categoryMap[category];
    categoryIcon.textContent = categoryInfo.emoji;
    categoryText.textContent = categoryInfo.name;
    
    // Atualiza op√ß√µes ativas
    document.querySelectorAll('.category-option').forEach(opt => {
        opt.classList.remove('active');
    });
    document.querySelector(`[data-category="${category}"]`).classList.add('active');
    
    // Fecha dropdown
    toggleCategoryDropdown();
    
    // Anima√ß√£o no bot√£o
    categoryBtn.classList.add('pulse');
    setTimeout(() => categoryBtn.classList.remove('pulse'), 600);
    
    // Aplica filtro
    applyCategoryFilter();
    
    console.log(`üéØ Categoria selecionada: ${categoryInfo.name}`);
}

// APLICAR FILTRO DE CATEGORIA
function applyCategoryFilter() {
    // Modifica a fun√ß√£o filterAndRenderStories existente
    let filteredStories = allStories;

    // FILTRO POR CATEGORIA
    if (selectedCategory !== 'all') {
        filteredStories = filteredStories.filter(story => story.genre === selectedCategory);
    }

    // Filtro de tipo (mant√©m o existente)
    if (currentFilter !== 'all') {
        filteredStories = filteredStories.filter(story => story.type === currentFilter);
    }

    // Pesquisa (mant√©m o existente)
    if (searchQuery && searchQuery.length > 0) {
        filteredStories = searchStories(searchQuery, searchFilter);
        if (currentFilter !== 'all') {
            filteredStories = filteredStories.filter(story => story.type === currentFilter);
        }
        if (selectedCategory !== 'all') {
            filteredStories = filteredStories.filter(story => story.genre === selectedCategory);
        }
    }

    // Ordena por mais reagidos (mant√©m o existente)
    filteredStories.sort((a, b) => {
        const aTotal = (a.stats?.views || 0) + (a.stats?.likes || 0) + (a.stats?.comments || 0);
        const bTotal = (b.stats?.views || 0) + (b.stats?.likes || 0) + (b.stats?.comments || 0);
        return bTotal - aTotal;
    });

    renderStories(filteredStories);
}

// ATUALIZAR CONTADORES
function updateCategoryCounts() {
    const counts = {
        all: allStories.length,
        musica: 0,
        comedia: 0,
        danca: 0,
        educativo: 0,
        lifestyle: 0,
        outros: 0
    };

    allStories.forEach(story => {
        if (counts.hasOwnProperty(story.genre)) {
            counts[story.genre]++;
        }
    });

    // Atualiza elementos
    Object.keys(counts).forEach(category => {
        const countEl = document.getElementById(`count-${category}`);
        if (countEl) {
            countEl.textContent = counts[category];
        }
    });
}

// SUBSTITUA a fun√ß√£o filterAndRenderStories pela applyCategoryFilter:
window.filterAndRenderStories = applyCategoryFilter;

// INICIALIZAR
updateCategoryCounts();

console.log('‚úÖ Filtro de categorias ativado!');
    </script>
    <script>
  const botao = document.querySelector('button.tab[data-tab="video"]');
  function autoClicar() {
    if (botao) {
      botao.click();
      console.log('Bot√£o clicado automaticamente ap√≥s 2 segundos.');
    } else {
      console.log('Bot√£o n√£o encontrado.');
    }
  }
  setTimeout(autoClicar, 2000); // 2000 milissegundos = 2 segundos
</script>

</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const invisibleBtn = document.getElementById('invisibleBtn');
    const overlayCloseBtn = document.getElementById('overlayClose');

    if (invisibleBtn && overlayCloseBtn) {
      invisibleBtn.addEventListener('click', () => {
        overlayCloseBtn.click();
      });
    }
  });
</script>
        <script>
    const toggleBtn = document.getElementById('toggleBtn');
    const buttons = [ 'likeBtn', 'commentBtn', 'viewBtn', 'likeCount', 'commentCount', 'viewCount' ].map(id => document.getElementById(id));
    
    // Estado para saber se os bot√µes est√£o vis√≠veis ou n√£o
    let visible = false;

    toggleBtn.addEventListener('click', () => {
        visible = !visible;
        buttons.forEach(btn => {
            btn.style.display = visible ? 'inline-block' : 'none';
        });
    });
</script>

<style>
  #heartIcon {
    transition: fill 0.4s ease, stroke 0.4s ease;
    fill: none;
    stroke: white;
  }
  
  #heartIcon.animating {
    fill: red;
    stroke: red;
  }
</style>

<script>
  const likeBtn = document.getElementById('likeBtn');
  const heartIcon = document.getElementById('heartIcon');

  likeBtn.addEventListener('click', () => {
    heartIcon.classList.add('animating');
    setTimeout(() => {
      heartIcon.classList.remove('animating');
    }, 600); // dura√ß√£o da anima√ß√£o
  });
</script>

</body>
</html>