<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialShop - Loja Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4845BE'
                    }
                }
            }
        }
    </script>
    <style>
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 transition-colors duration-300">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white dark:bg-gray-900 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
            <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-2">Kuia+ Shop</h2>
            <p id="loadingStatus" class="text-gray-600 dark:text-gray-400">Carregando...</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="fixed inset-0 bg-white dark:bg-gray-900 flex items-center justify-center z-40 hidden">
        <div style="display:none;" class="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-2xl max-w-md w-full mx-4 border border-gray-200 dark:border-gray-700">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-200 mb-2">SocialShop</h1>
                <p class="text-gray-600 dark:text-gray-400">Bem-vindo ao Kuia+ Shop</p>
                <p class="text-sm text-gray-500 dark:text-gray-500 mt-2">Fa√ßa login para continuar</p>
            </div>
            <button id="googleLoginBtn" class="w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 py-3 px-4 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors flex items-center justify-center space-x-3">
                <svg class="w-5 h-5" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                <span>Continuar com Google</span>
            </button>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-30">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <h1 class="text-2xl font-bold text-primary">Kuia+ Shop</h1>
                        <div class="hidden md:flex space-x-6">
                            <button id="homeBtn" class="nav-btn text-gray-700 dark:text-gray-300 hover:text-primary px-3 py-2 rounded-md text-sm font-medium">
                                <span class="mr-2">üè†</span>In√≠cio
                            </button>
                            <button id="categoriesBtn" class="nav-btn text-gray-700 dark:text-gray-300 hover:text-primary px-3 py-2 rounded-md text-sm font-medium">
                                <span class="mr-2">üìÇ</span>Categorias
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <!-- Search -->
                        <div class="hidden sm:block relative">
                            <input type="text" id="searchInput" placeholder="Buscar produtos..." 
                                   class="w-64 px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent pr-10">
                            <svg class="absolute right-3 top-3 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                        
                        <!-- Cart -->
                        <button id="cartBtn" class="relative p-2 text-gray-700 dark:text-gray-300 hover:text-primary text-2xl">
                            üõí
                            <span id="cartCount" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                        </button>
                        
                        <!-- User Menu -->
                        <div class="relative">
                            <button id="userMenuBtn" class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                                <img id="userAvatar" src="" alt="Avatar" class="w-8 h-8 rounded-full">
                                <span id="userName" class="hidden sm:block text-sm font-medium text-gray-700 dark:text-gray-300"></span>                             
                            </button>
                            <div style="display:none;" id="userMenu" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50">
                                <button id="adminBtn" class="hidden w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-t-lg">
                                    <span class="mr-2">‚öôÔ∏è</span>Administra√ß√£o
                                </button>
                                <button id="logoutBtn" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b-lg">
                                    <span class="mr-2">üö™</span>Sair
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Mobile Menu -->
        <div class="md:hidden bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
            <div class="px-4 py-2">
                <input type="text" id="mobileSearchInput" placeholder="Buscar produtos..." 
                       class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
            </div>
            <div class="flex">
                <button id="mobileHomeBtn" class="flex-1 nav-btn text-center py-3 text-gray-700 dark:text-gray-300 hover:text-primary">
                    <div class="text-lg">üè†</div>
                    <span class="text-xs mt-1">In√≠cio</span>
                </button>
                <button id="mobileCategoriesBtn" class="flex-1 nav-btn text-center py-3 text-gray-700 dark:text-gray-300 hover:text-primary">
                    <div class="text-lg">üìÇ</div>
                    <span class="text-xs mt-1">Categorias</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Home Section -->
            <div id="homeSection">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-200 mb-4">Produtos Dispon√≠veis</h2>
                    <div class="flex flex-wrap gap-2 mb-6">
                        <button class="category-filter-btn bg-primary text-white px-4 py-2 rounded-full text-sm font-medium" data-category="all">
                            Todos
                        </button>
                    </div>
                </div>
                
                <div id="productsGrid" class="grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
                    <div class="text-center py-12">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
                        <p class="text-gray-600 dark:text-gray-400">Carregando produtos...</p>
                    </div>
                </div>
            </div>

            <!-- Categories Section -->
            <div id="categoriesSection" class="hidden">
                <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-200 mb-8">Categorias</h2>
                <div id="categoriesGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
                    <div class="text-center py-12">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
                        <p class="text-gray-600 dark:text-gray-400">Carregando categorias...</p>
                    </div>
                </div>
            </div>

            <!-- Admin Section -->
            <div id="adminSection" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-200">Administra√ß√£o</h2>
                    <button id="addProductBtn" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary-dark transition-colors">
                        <span class="mr-2">‚ûï</span>Adicionar Produto
                    </button>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Produto</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Categoria</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Pre√ßo</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Estoque</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="adminProductsList" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <tr>
                                    <td colspan="5" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto mb-2"></div>
                                        Carregando produtos...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Cart Sidebar -->
    <div id="cartSidebar" class="fixed inset-y-0 right-0 w-80 bg-white dark:bg-gray-800 shadow-xl transform translate-x-full transition-transform z-50 border-l border-gray-200 dark:border-gray-700">
        <div class="flex flex-col h-full">
            <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Carrinho de Compras</h3>
                <button id="closeCartBtn" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl">
                    ‚ùå
                </button>
            </div>
            
            <div id="cartItems" class="flex-1 overflow-y-auto p-6">
                <div class="text-center py-12">
                    <div class="text-4xl mb-4">üõí</div>
                    <p class="text-gray-500 dark:text-gray-400">Seu carrinho est√° vazio</p>
                </div>
            </div>
            
            <div class="border-t border-gray-200 dark:border-gray-700 p-6">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-lg font-semibold text-gray-800 dark:text-gray-200">Total:</span>
                    <span id="cartTotal" class="text-lg font-bold text-primary">0 Kz</span>
                </div>
                <button id="checkoutBtn" class="w-full bg-primary text-white py-3 rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Finalizar Compra
                </button>
            </div>
        </div>
    </div>

    <!-- Cart Overlay -->
    <div id="cartOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg max-w-md w-full max-h-96 overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-start mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-200">Finalizar Compra</h3>
                    <button id="closeCheckoutBtn" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl">
                        ‚ùå
                    </button>
                </div>
                
                <form id="checkoutForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nome Completo *</label>
                            <input type="text" id="customerName" required value="" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">N√∫mero de Telefone *</label>
                            <input type="tel" id="customerPhone" required placeholder="+244 xxx xxx xxx" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Localiza√ß√£o Exata *</label>
                            <textarea id="customerLocation" required rows="3" placeholder="Endere√ßo completo, prov√≠ncia, munic√≠pio..." class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Mensagem Opcional</label>
                            <textarea id="customerMessage" rows="2" placeholder="Instru√ß√µes especiais de entrega..." class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                        </div>

                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Resumo do Pedido</h4>
                            <div id="checkoutSummary" class="space-y-2"></div>
                            <div class="border-t border-gray-200 dark:border-gray-600 pt-2 mt-2">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-gray-800 dark:text-gray-200">Total:</span>
                                    <span id="checkoutTotal" class="font-bold text-primary text-lg"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" id="cancelCheckoutBtn" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            Cancelar
                        </button>
                        <button type="submit" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
                            <span class="mr-2">‚úÖ</span>Confirmar Pedido
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div id="productDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full max-h-96 overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-start mb-4">
                    <h3 id="detailModalTitle" class="text-xl font-semibold text-gray-800 dark:text-gray-200">Detalhes do Produto</h3>
                    <button id="closeDetailModalBtn" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl">
                        ‚ùå
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <div id="detailImage" class="w-full h-64 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                            <div class="text-4xl text-gray-400">üñºÔ∏è</div>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <h4 id="detailName" class="text-xl font-bold text-gray-800 dark:text-gray-200"></h4>
                            <p id="detailCategory" class="text-gray-600 dark:text-gray-400 capitalize"></p>
                        </div>
                        
                        <div class="space-y-2">
                            <div id="detailPriceContainer" class="flex items-center space-x-2">
                                <span id="detailPrice" class="text-2xl font-bold text-primary"></span>
                                <span id="detailOldPrice" class="text-lg text-gray-400 line-through hidden"></span>
                                <span id="detailDiscount" class="bg-red-500 text-white px-2 py-1 rounded text-sm hidden"></span>
                            </div>
                        </div>
                        
                        <div>
                            <p id="detailStock" class="text-sm text-gray-600 dark:text-gray-400"></p>
                        </div>
                        
                        <div id="detailDescriptionContainer" class="hidden">
                            <h5 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Descri√ß√£o</h5>
                            <p id="detailDescription" class="text-gray-600 dark:text-gray-400 text-sm"></p>
                        </div>
                        
                        <button id="detailAddToCartBtn" class="w-full bg-primary text-white py-3 rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="mr-2">üõí</span>Adicionar ao Carrinho
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full max-h-96 overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-start mb-4">
                    <h3 id="modalTitle" class="text-xl font-semibold text-gray-800 dark:text-gray-200"></h3>
                    <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl">
                        ‚ùå
                    </button>
                </div>
                
                <form id="productForm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nome do Produto</label>
                            <input type="text" id="productName" required class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Categoria</label>
                            <select id="productCategory" required 
    class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 
           rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 
           focus:ring-2 focus:ring-primary focus:border-transparent">
    <option value="">Selecione uma categoria</option>
    <option value="eletronicos">Eletr√¥nicos</option>
    <option value="roupas">Roupas</option>
    <option value="casa">Casa e Jardim</option>
    <option value="livros">Livros</option>
    <option value="esportes">Esportes</option>
    <option value="beleza">Beleza</option>
    <option value="acessorios">Acess√≥rios & Joias</option>
    <option value="calcados">Cal√ßados</option>
    <option value="alimentacao">Alimenta√ß√£o & Bebidas</option>
    <option value="saude">Sa√∫de & Bem-estar</option>
    <option value="automotivo">Automotivo</option>
    <option value="brinquedos">Brinquedos & Jogos</option>
    <option value="musica">M√∫sica & Instrumentos</option>
    <option value="arte">Arte & Artesanato</option>
    <option value="pets">Pets</option>
    <option value="servicos">Servi√ßos</option>
</select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Pre√ßo Atual (Kz)</label>
                            <input type="number" id="productPrice" step="0.01" min="0" required class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Pre√ßo Anterior (Kz) - Opcional</label>
                            <input type="number" id="productOldPrice" step="0.01" min="0" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Para mostrar desconto">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Estoque</label>
                            <input type="number" id="productStock" min="0" required class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Descri√ß√£o</label>
                        <textarea id="productDescription" rows="3" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">URL da Imagem</label>
                        <input type="url" id="productImage" placeholder="https://exemplo.com/imagem.jpg" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" id="cancelModalBtn" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            Cancelar
                        </button>
                        <button type="submit" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
                            <span class="mr-2">üíæ</span>Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        console.log('üöÄ Iniciando SocialShop...');
        document.getElementById('loadingStatus').textContent = 'Carregando Firebase...';

        // Firebase imports
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js';
        import { getDatabase, ref, onValue, push, set, remove } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js';

        console.log('‚úÖ Firebase modules loaded');
        document.getElementById('loadingStatus').textContent = 'Conectando ao Firebase...';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCE_vGty5XsV1YqdCi49Ck2xJDSFq284wc",
            authDomain: "cliente-movicel.firebaseapp.com",
            databaseURL: "https://cliente-movicel-default-rtdb.firebaseio.com",
            projectId: "cliente-movicel",
            storageBucket: "cliente-movicel.firebasestorage.app",
            messagingSenderId: "215414688375",
            appId: "1:215414688375:web:2c7d20a0c03c4c0fcfd472",
            measurementId: "G-7F1RGP9GHV"
        };

        // Initialize Firebase
        let app, auth, database;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            database = getDatabase(app);
            console.log('‚úÖ Firebase initialized successfully');
            document.getElementById('loadingStatus').textContent = 'Firebase conectado!';
        } catch (error) {
            console.error('‚ùå Firebase initialization error:', error);
            document.getElementById('loadingStatus').textContent = 'Erro na conex√£o. Usando modo offline.';
        }

        // Dark mode setup
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Global variables
        let currentUser = null;
        let cart = [];
        let products = {};
        let categories = [];
        let currentSection = 'home';
        let editingProductId = null;

        // Initialize admin emails
        const adminEmails = ['sibemcesar@gmail.com']; // Add your email here

        // DOM elements
        const loadingScreen = document.getElementById('loadingScreen');
        const loginScreen = document.getElementById('loginScreen');
        const mainApp = document.getElementById('mainApp');
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userMenuBtn = document.getElementById('userMenuBtn');
        const userMenu = document.getElementById('userMenu');
        const adminBtn = document.getElementById('adminBtn');

        // Cart elements
        const cartBtn = document.getElementById('cartBtn');
        const cartSidebar = document.getElementById('cartSidebar');
        const cartOverlay = document.getElementById('cartOverlay');
        const closeCartBtn = document.getElementById('closeCartBtn');
        const cartItems = document.getElementById('cartItems');
        const cartTotal = document.getElementById('cartTotal');
        const cartCount = document.getElementById('cartCount');
        const checkoutBtn = document.getElementById('checkoutBtn');

        // Navigation elements
        const homeBtn = document.getElementById('homeBtn');
        const categoriesBtn = document.getElementById('categoriesBtn');
        const mobileHomeBtn = document.getElementById('mobileHomeBtn');
        const mobileCategoriesBtn = document.getElementById('mobileCategoriesBtn');

        // Section elements
        const homeSection = document.getElementById('homeSection');
        const categoriesSection = document.getElementById('categoriesSection');
        const adminSection = document.getElementById('adminSection');

        // Product elements
        const productsGrid = document.getElementById('productsGrid');
        const categoriesGrid = document.getElementById('categoriesGrid');
        const searchInput = document.getElementById('searchInput');
        const mobileSearchInput = document.getElementById('mobileSearchInput');

        // Modal elements
        const productModal = document.getElementById('productModal');
        const modalTitle = document.getElementById('modalTitle');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelModalBtn = document.getElementById('cancelModalBtn');
        const productForm = document.getElementById('productForm');
        const addProductBtn = document.getElementById('addProductBtn');
        const adminProductsList = document.getElementById('adminProductsList');

        // Checkout elements
        const checkoutModal = document.getElementById('checkoutModal');
        const closeCheckoutBtn = document.getElementById('closeCheckoutBtn');
        const cancelCheckoutBtn = document.getElementById('cancelCheckoutBtn');
        const checkoutForm = document.getElementById('checkoutForm');
        const checkoutSummary = document.getElementById('checkoutSummary');
        const checkoutTotal = document.getElementById('checkoutTotal');

        // Product detail elements
        const productDetailModal = document.getElementById('productDetailModal');
        const closeDetailModalBtn = document.getElementById('closeDetailModalBtn');
        const detailModalTitle = document.getElementById('detailModalTitle');
        const detailImage = document.getElementById('detailImage');
        const detailName = document.getElementById('detailName');
        const detailCategory = document.getElementById('detailCategory');
        const detailPrice = document.getElementById('detailPrice');
        const detailOldPrice = document.getElementById('detailOldPrice');
        const detailDiscount = document.getElementById('detailDiscount');
        const detailStock = document.getElementById('detailStock');
        const detailDescription = document.getElementById('detailDescription');
        const detailDescriptionContainer = document.getElementById('detailDescriptionContainer');
        const detailAddToCartBtn = document.getElementById('detailAddToCartBtn');

        // Authentication
        onAuthStateChanged(auth, (user) => {
            console.log('Auth state changed:', user);
            currentUser = user;
            
            if (user) {
                // User is signed in
                userAvatar.src = user.photoURL || 'https://via.placeholder.com/32';
                userName.textContent = user.displayName || user.email;
                
                // Check if user is admin
                if (adminEmails.includes(user.email)) {
                    adminBtn.classList.remove('hidden');
                }
                
                showMainApp();
                loadData();
            } else {
                // User is signed out
                showLoginScreen();
            }
        });

        googleLoginBtn.addEventListener('click', async () => {
            try {
                const provider = new GoogleAuthProvider();
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error('Login error:', error);
                showCustomAlert('Erro no login. Tente novamente.');
            }
        });

        logoutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                cart = [];
                updateCartUI();
                adminBtn.classList.add('hidden');
            } catch (error) {
                console.error('Logout error:', error);
            }
        });

        // User menu toggle
        userMenuBtn.addEventListener('click', () => {
            userMenu.classList.toggle('hidden');
        });

        // Close user menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!userMenuBtn.contains(e.target) && !userMenu.contains(e.target)) {
                userMenu.classList.add('hidden');
            }
        });

        // Cart functionality
        cartBtn.addEventListener('click', () => {
            cartSidebar.classList.remove('translate-x-full');
            cartOverlay.classList.remove('hidden');
        });

        closeCartBtn.addEventListener('click', closeCart);
        cartOverlay.addEventListener('click', closeCart);

        function closeCart() {
            cartSidebar.classList.add('translate-x-full');
            cartOverlay.classList.add('hidden');
        }

        // Navigation
        homeBtn.addEventListener('click', () => showSection('home'));
        categoriesBtn.addEventListener('click', () => showSection('categories'));
        mobileHomeBtn.addEventListener('click', () => showSection('home'));
        mobileCategoriesBtn.addEventListener('click', () => showSection('categories'));
        adminBtn.addEventListener('click', () => showSection('admin'));

        // Search functionality
        searchInput.addEventListener('input', filterProducts);
        mobileSearchInput.addEventListener('input', filterProducts);

        // Modal functionality
        addProductBtn.addEventListener('click', () => openProductModal());
        closeModalBtn.addEventListener('click', closeProductModal);
        cancelModalBtn.addEventListener('click', closeProductModal);
        productForm.addEventListener('submit', saveProduct);

        // Checkout
        checkoutBtn.addEventListener('click', openCheckout);
        closeCheckoutBtn.addEventListener('click', closeCheckout);
        cancelCheckoutBtn.addEventListener('click', closeCheckout);
        checkoutForm.addEventListener('submit', processOrder);

        // Product detail modal
        closeDetailModalBtn.addEventListener('click', closeProductDetail);

        function openCheckout() {
            if (cart.length === 0) return;
            
            // Pre-fill name if user is logged in
            if (currentUser) {
                document.getElementById('customerName').value = currentUser.displayName || '';
            }
            
            updateCheckoutSummary();
            checkoutModal.classList.remove('hidden');
        }

        function closeCheckout() {
            checkoutModal.classList.add('hidden');
            checkoutForm.reset();
        }

        function updateCheckoutSummary() {
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            checkoutSummary.innerHTML = cart.map(item => `
                <div class="flex justify-between text-sm">
                    <span>${item.name} (${item.quantity}x)</span>
                    <span>${formatPrice(item.price * item.quantity)}</span>
                </div>
            `).join('');
            
            checkoutTotal.textContent = formatPrice(totalPrice);
        }

        async function processOrder(e) {
            e.preventDefault();
            
            const orderData = {
                customer: {
                    name: document.getElementById('customerName').value,
                    phone: document.getElementById('customerPhone').value,
                    location: document.getElementById('customerLocation').value,
                    message: document.getElementById('customerMessage').value,
                    email: currentUser?.email || '',
                    userId: currentUser?.uid || ''
                },
                items: cart.map(item => ({
                    productId: item.id,
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity
                })),
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                status: 'pending',
                createdAt: Date.now()
            };
            
            try {
                await push(ref(database, 'orders'), orderData);
                
                // Clear cart and close modals
                cart = [];
                updateCartUI();
                closeCheckout();
                closeCart();
                
                showCustomAlert('Pedido realizado com sucesso! Em breve entraremos em contato.');
            } catch (error) {
                console.error('Error processing order:', error);
                showCustomAlert('Erro ao processar pedido. Tente novamente.');
            }
        }

        // Load data from Firebase
        function loadData() {
            // Load products
            const productsRef = ref(database, 'products');
            onValue(productsRef, (snapshot) => {
                products = snapshot.val() || {};
                renderProducts();
                updateCategories();
                renderAdminProducts();
            });
        }

        function renderProducts() {
            const productsArray = Object.entries(products).map(([id, product]) => ({ id, ...product }));
            const searchTerm = (searchInput.value || mobileSearchInput.value || '').toLowerCase();
            const activeCategory = document.querySelector('.category-filter-btn.bg-primary')?.dataset.category || 'all';
            
            let filteredProducts = productsArray;
            
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.description?.toLowerCase().includes(searchTerm) ||
                    product.category.toLowerCase().includes(searchTerm)
                );
            }
            
            if (activeCategory !== 'all') {
                filteredProducts = filteredProducts.filter(product => product.category === activeCategory);
            }

            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-4xl mb-4">üîç</div>
                        <p class="text-gray-500 dark:text-gray-400">Nenhum produto encontrado</p>
                    </div>
                `;
                return;
            }

            productsGrid.innerHTML = filteredProducts.map(product => {
                const hasDiscount = product.oldPrice && product.oldPrice > product.price;
                const discountPercent = hasDiscount ? Math.round(((product.oldPrice - product.price) / product.oldPrice) * 100) : 0;
                
                return `
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-lg transition-shadow cursor-pointer"
                     onclick="showProductDetail('${product.id}')">
                    <div class="relative aspect-w-1 aspect-h-1 w-full h-40 sm:h-48 bg-gray-200 dark:bg-gray-700">
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover">` :
                            `<div class="w-full h-full flex items-center justify-center">
                                <div class="text-2xl sm:text-3xl text-gray-400">üñºÔ∏è</div>
                            </div>`
                        }
                        ${hasDiscount ? `
                            <div class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded text-xs font-bold">
                                -${discountPercent}%
                            </div>
                        ` : ''}
                        ${product.stock === 0 ? `
                            <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                                <span class="text-white font-bold text-sm">Esgotado</span>
                            </div>
                        ` : ''}
                    </div>
                    <div class="p-3 sm:p-4">
                        <h3 class="font-semibold text-gray-800 dark:text-gray-200 mb-2 text-sm sm:text-base line-clamp-2">${product.name}</h3>
                        <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-2 capitalize">${getCategoryName(product.category)}</p>
                        
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-lg sm:text-xl font-bold text-primary">${formatPrice(product.price)}</span>
                            ${hasDiscount ? `<span class="text-sm text-gray-400 line-through">${formatPrice(product.oldPrice)}</span>` : ''}
                        </div>
                        
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-xs text-gray-500 dark:text-gray-400">
                                <span class="mr-1">üì¶</span>${product.stock} dispon√≠vel
                            </span>
                            ${product.stock > 0 && product.stock <= 5 ? `
                                <span class="text-xs text-orange-500 font-medium">√öltimas unidades!</span>
                            ` : ''}
                        </div>
                        
                        <button onclick="event.stopPropagation(); addToCart('${product.id}')" 
                                class="w-full text-sm sm:text-base bg-primary text-white py-2 rounded-lg hover:bg-primary-dark transition-colors ${product.stock === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                                ${product.stock === 0 ? 'disabled' : ''}>
                            <span class="mr-1 sm:mr-2">üõí</span>${product.stock === 0 ? 'Sem Estoque' : 'Adicionar'}
                        </button>
                    </div>
                </div>
            `;
            }).join('');
        }

        function updateCategories() {
            const productCategories = [...new Set(Object.values(products).map(p => p.category))];
            categories = productCategories;
            
            // Update category filters
            const filterContainer = document.querySelector('.flex.flex-wrap.gap-2');
            if (filterContainer) {
                filterContainer.innerHTML = `
                    <button class="category-filter-btn bg-primary text-white px-4 py-2 rounded-full text-sm font-medium" data-category="all">
                        Todos
                    </button>
                    ${categories.map(category => `
                        <button class="category-filter-btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 px-4 py-2 rounded-full text-sm font-medium" data-category="${category}">
                            ${getCategoryName(category)}
                        </button>
                    `).join('')}
                `;
                
                // Add event listeners to filter buttons
                document.querySelectorAll('.category-filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.category-filter-btn').forEach(b => {
                            b.classList.remove('bg-primary', 'text-white');
                            b.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
                        });
                        btn.classList.add('bg-primary', 'text-white');
                        btn.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
                        renderProducts();
                    });
                });
            }
            
            renderCategories();
        }

        function renderCategories() {
            if (categories.length === 0) {
                categoriesGrid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-4xl mb-4">üìÇ</div>
                        <p class="text-gray-500 dark:text-gray-400">Nenhuma categoria dispon√≠vel</p>
                    </div>
                `;
                return;
            }

            categoriesGrid.innerHTML = categories.map(category => {
                const categoryProducts = Object.values(products).filter(p => p.category === category);
                return `
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 hover:shadow-lg transition-shadow cursor-pointer"
                         onclick="filterByCategory('${category}')">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mx-auto mb-4">
                                <div class="text-2xl text-primary">${getCategoryIcon(category)}</div>
                            </div>
                            <h3 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">${getCategoryName(category)}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">${categoryProducts.length} produtos</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderAdminProducts() {
            if (!adminBtn.classList.contains('hidden')) {
                const productsArray = Object.entries(products).map(([id, product]) => ({ id, ...product }));
                
                if (productsArray.length === 0) {
                    adminProductsList.innerHTML = `
                        <tr>
                            <td colspan="5" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                                Nenhum produto cadastrado
                            </td>
                        </tr>
                    `;
                    return;
                }

                adminProductsList.innerHTML = productsArray.map(product => `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10">
                                    ${product.image ? 
                                        `<img class="h-10 w-10 rounded object-cover" src="${product.image}" alt="${product.name}">` :
                                        `<div class="h-10 w-10 rounded bg-gray-200 dark:bg-gray-600 flex items-center justify-center">
                                            üñºÔ∏è
                                        </div>`
                                    }
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900 dark:text-gray-100">${product.name}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 capitalize">
                            ${getCategoryName(product.category)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">
                            ${formatPrice(product.price)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">
                            ${product.stock}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="editProduct('${product.id}')" class="text-primary hover:text-primary-dark mr-3" title="Editar">
                                ‚úèÔ∏è
                            </button>
                            <button onclick="deleteProduct('${product.id}')" class="text-red-600 hover:text-red-900" title="Excluir">
                                üóëÔ∏è
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Cart functions
        window.addToCart = function(productId) {
            const product = products[productId];
            if (!product || product.stock === 0) return;
            
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity++;
                }
            } else {
                cart.push({ ...product, id: productId, quantity: 1 });
            }
            
            updateCartUI();
        };

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartUI();
        }

        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (!item) return;
            
            const product = products[productId];
            const newQuantity = item.quantity + change;
            
            if (newQuantity <= 0) {
                removeFromCart(productId);
            } else if (newQuantity <= product.stock) {
                item.quantity = newQuantity;
                updateCartUI();
            }
        }

        function updateCartUI() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            cartCount.textContent = totalItems;
            cartTotal.textContent = formatPrice(totalPrice);
            checkoutBtn.disabled = cart.length === 0;
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-4xl mb-4">üõí</div>
                        <p class="text-gray-500 dark:text-gray-400">Seu carrinho est√° vazio</p>
                    </div>
                `;
            } else {
                cartItems.innerHTML = cart.map(item => `
                    <div class="flex items-center space-x-3 py-3 border-b border-gray-200 dark:border-gray-700 last:border-b-0">
                        <div class="flex-shrink-0 w-12 h-12 bg-gray-200 dark:bg-gray-600 rounded">
                            ${item.image ? 
                                `<img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover rounded">` :
                                `<div class="w-full h-full flex items-center justify-center">
                                    üñºÔ∏è
                                </div>`
                            }
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-900 dark:text-gray-100 truncate">${item.name}</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">${formatPrice(item.price)}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="updateQuantity('${item.id}', -1)" class="w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center text-xs hover:bg-gray-300 dark:hover:bg-gray-500">
                                ‚ûñ
                            </button>
                            <span class="text-sm w-8 text-center">${item.quantity}</span>
                            <button onclick="updateQuantity('${item.id}', 1)" class="w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center text-xs hover:bg-gray-300 dark:hover:bg-gray-500">
                                ‚ûï
                            </button>
                        </div>
                        <button onclick="removeFromCart('${item.id}')" class="text-red-500 hover:text-red-700">
                            üóëÔ∏è
                        </button>
                    </div>
                `).join('');
            }
        }

        // Product management
        function openProductModal(productId = null) {
            editingProductId = productId;
            
            if (productId) {
                modalTitle.textContent = 'Editar Produto';
                const product = products[productId];
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productOldPrice').value = product.oldPrice || '';
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productDescription').value = product.description || '';
                document.getElementById('productImage').value = product.image || '';
            } else {
                modalTitle.textContent = 'Adicionar Produto';
                productForm.reset();
            }
            
            productModal.classList.remove('hidden');
        }

        function closeProductModal() {
            productModal.classList.add('hidden');
            editingProductId = null;
            productForm.reset();
        }

        async function saveProduct(e) {
            e.preventDefault();
            
            const oldPriceValue = document.getElementById('productOldPrice').value;
            const productData = {
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                price: parseFloat(document.getElementById('productPrice').value),
                oldPrice: oldPriceValue ? parseFloat(oldPriceValue) : null,
                stock: parseInt(document.getElementById('productStock').value),
                description: document.getElementById('productDescription').value,
                image: document.getElementById('productImage').value,
                createdAt: editingProductId ? products[editingProductId].createdAt : Date.now(),
                updatedAt: Date.now()
            };
            
            try {
                if (editingProductId) {
                    await set(ref(database, `products/${editingProductId}`), productData);
                } else {
                    await push(ref(database, 'products'), productData);
                }
                closeProductModal();
            } catch (error) {
                console.error('Error saving product:', error);
                showCustomAlert('Erro ao salvar produto');
            }
        }

        // Product detail functions
        window.showProductDetail = function(productId) {
            const product = products[productId];
            if (!product) return;
            
            detailModalTitle.textContent = 'Detalhes do Produto';
            detailName.textContent = product.name;
            detailCategory.textContent = getCategoryName(product.category);
            detailPrice.textContent = formatPrice(product.price);
            
            // Handle old price and discount
            if (product.oldPrice && product.oldPrice > product.price) {
                const discountPercent = Math.round(((product.oldPrice - product.price) / product.oldPrice) * 100);
                detailOldPrice.textContent = formatPrice(product.oldPrice);
                detailOldPrice.classList.remove('hidden');
                detailDiscount.textContent = `-${discountPercent}%`;
                detailDiscount.classList.remove('hidden');
            } else {
                detailOldPrice.classList.add('hidden');
                detailDiscount.classList.add('hidden');
            }
            
            // Handle stock
            if (product.stock > 0) {
                detailStock.innerHTML = `<span class="mr-2">‚úÖ</span>${product.stock} unidades em estoque`;
                detailAddToCartBtn.disabled = false;
                detailAddToCartBtn.innerHTML = '<span class="mr-2">üõí</span>Adicionar ao Carrinho';
            } else {
                detailStock.innerHTML = '<span class="mr-2">‚ùå</span>Produto esgotado';
                detailAddToCartBtn.disabled = true;
                detailAddToCartBtn.innerHTML = '<span class="mr-2">üö´</span>Sem Estoque';
            }
            
            // Handle description
            if (product.description && product.description.trim()) {
                detailDescription.textContent = product.description;
                detailDescriptionContainer.classList.remove('hidden');
            } else {
                detailDescriptionContainer.classList.add('hidden');
            }
            
            // Handle image
            if (product.image) {
                detailImage.innerHTML = `<img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover rounded-lg">`;
            } else {
                detailImage.innerHTML = '<div class="text-4xl text-gray-400">üñºÔ∏è</div>';
            }
            
            // Set up add to cart button
            detailAddToCartBtn.onclick = () => {
                if (product.stock > 0) {
                    addToCart(productId);
                    closeProductDetail();
                }
            };
            
            productDetailModal.classList.remove('hidden');
        };

        function closeProductDetail() {
            productDetailModal.classList.add('hidden');
        }

        window.editProduct = function(productId) {
            openProductModal(productId);
        };

        window.deleteProduct = function(productId) {
            function showCustomConfirm(message, onConfirm) {
  if (confirm(message)) {
    onConfirm();
  }
}
            showCustomConfirm('Tem certeza que deseja excluir este produto?', async () => {
                try {
                    await remove(ref(database, `products/${productId}`));
                    showCustomAlert('Produto exclu√≠do com sucesso!');
                } catch (error) {
                    console.error('Error deleting product:', error);
                    showCustomAlert('Erro ao excluir produto: ' + error.message);
                }
            });
        };

        // Navigation functions
        function showSection(section) {
            currentSection = section;
            
            // Hide all sections
            homeSection.classList.add('hidden');
            categoriesSection.classList.add('hidden');
            adminSection.classList.add('hidden');
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-primary');
                btn.classList.add('text-gray-700', 'dark:text-gray-300');
            });
            
            // Show selected section and update nav
            switch (section) {
                case 'home':
                    homeSection.classList.remove('hidden');
                    homeBtn.classList.add('text-primary');
                    mobileHomeBtn.classList.add('text-primary');
                    break;
                case 'categories':
                    categoriesSection.classList.remove('hidden');
                    categoriesBtn.classList.add('text-primary');
                    mobileCategoriesBtn.classList.add('text-primary');
                    break;
                case 'admin':
                    adminSection.classList.remove('hidden');
                    break;
            }
        }

        window.filterByCategory = function(category) {
            showSection('home');
            
            // Update category filter
            document.querySelectorAll('.category-filter-btn').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
            });
            
            const categoryBtn = document.querySelector(`.category-filter-btn[data-category="${category}"]`);
            if (categoryBtn) {
                categoryBtn.classList.add('bg-primary', 'text-white');
                categoryBtn.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
            }
            
            renderProducts();
        };

        function filterProducts() {
            renderProducts();
        }

        // Utility functions
        function formatPrice(price) {
            return `${Math.round(price).toLocaleString('pt-AO')} Kz`;
        }

        function getCategoryName(category) {
    const categoryNames = {
        'eletronicos': 'Eletr√¥nicos',
        'roupas': 'Roupas',
        'casa': 'Casa e Jardim',
        'livros': 'Livros',
        'esportes': 'Esportes',
        'beleza': 'Beleza',
        'acessorios': 'Acess√≥rios & Joias',
        'calcados': 'Cal√ßados',
        'alimentacao': 'Alimenta√ß√£o & Bebidas',
        'saude': 'Sa√∫de & Bem-estar',
        'automotivo': 'Automotivo',
        'brinquedos': 'Brinquedos & Jogos',
        'musica': 'M√∫sica & Instrumentos',
        'arte': 'Arte & Artesanato',
        'pets': 'Pets',
        'servicos': 'Servi√ßos'
    };
    return categoryNames[category] || category;
}

function getCategoryIcon(category) {
    const categoryIcons = {
        'eletronicos': 'üíª',
        'roupas': 'üëï',
        'casa': 'üè†',
        'livros': 'üìö',
        'esportes': '‚öΩ',
        'beleza': 'üíÑ',
        'acessorios': 'üíç',
        'calcados': 'üëü',
        'alimentacao': 'üçî',
        'saude': 'üíä',
        'automotivo': 'üöó',
        'brinquedos': 'üß∏',
        'musica': 'üé∏',
        'arte': 'üé®',
        'pets': 'üê∂',
        'servicos': 'üõ†Ô∏è'
    };
    return categoryIcons[category] || 'üè∑Ô∏è';
}

        function showMainApp() {
            loadingScreen.classList.add('hidden');
            loginScreen.classList.add('hidden');
            mainApp.classList.remove('hidden');
        }

        function showLoginScreen() {
            loadingScreen.classList.add('hidden');
            mainApp.classList.add('hidden');
            loginScreen.classList.remove('hidden');
        }

        // Custom alert and confirm functions
        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-primary text-white hover:bg-primary-dark rounded" onclick="this.closest('.fixed').remove()">OK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showCustomConfirm(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" onclick="this.closest('.fixed').remove()">Cancelar</button>
                        <button class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded" onclick="this.closest('.fixed').remove(); (${onConfirm.toString()})()">Confirmar</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Make functions available globally
        window.updateQuantity = updateQuantity;
        window.removeFromCart = removeFromCart;

        // Initialize the app
        setTimeout(() => {
            if (!currentUser) {
                showLoginScreen();
            }
        }, 2000);
    </script>
    
</body>
</html>